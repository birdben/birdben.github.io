<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>ELK学习（二）ELK利用GeoIP进行地理定位 | birdben</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="上一篇我们对Nginx的access.log进行了初步的解析和提取字段处理，如果想进一步对客户端的IP来源进行分析和地理定位，我们需要借助第三方库GeoIP来进行地理定位。
GeoIP的使用这里要说明一下GeoIP是一个免费的IP定位数据库，现在目前有两个版本GeoIP和GeoIP2
GeoIP官网地址：

https://www.maxmind.com/zh/home

这里GeoIP和GeoI">
<meta property="og:type" content="article">
<meta property="og:title" content="ELK学习（二）ELK利用GeoIP进行地理定位">
<meta property="og:url" content="https://github.com/birdben/2017/01/23/ELK/ELK学习（二）ELK利用GeoIP进行地理定位/index.html">
<meta property="og:site_name" content="birdben">
<meta property="og:description" content="上一篇我们对Nginx的access.log进行了初步的解析和提取字段处理，如果想进一步对客户端的IP来源进行分析和地理定位，我们需要借助第三方库GeoIP来进行地理定位。
GeoIP的使用这里要说明一下GeoIP是一个免费的IP定位数据库，现在目前有两个版本GeoIP和GeoIP2
GeoIP官网地址：

https://www.maxmind.com/zh/home

这里GeoIP和GeoI">
<meta property="og:image" content="http://img.blog.csdn.net/20170124100943166?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmlyZGJlbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20170124101512772?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmlyZGJlbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://img.blog.csdn.net/20170123230821712?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmlyZGJlbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:updated_time" content="2017-05-07T10:48:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ELK学习（二）ELK利用GeoIP进行地理定位">
<meta name="twitter:description" content="上一篇我们对Nginx的access.log进行了初步的解析和提取字段处理，如果想进一步对客户端的IP来源进行分析和地理定位，我们需要借助第三方库GeoIP来进行地理定位。
GeoIP的使用这里要说明一下GeoIP是一个免费的IP定位数据库，现在目前有两个版本GeoIP和GeoIP2
GeoIP官网地址：

https://www.maxmind.com/zh/home

这里GeoIP和GeoI">
<meta name="twitter:image" content="http://img.blog.csdn.net/20170124100943166?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmlyZGJlbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
  
    <link rel="alternative" href="/atom.xml" title="birdben" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
<script type="text/javascript">
var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260188951'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1260188951' type='text/javascript'%3E%3C/script%3E"));
</script>

</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/images/logo.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">birdben</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/birdben" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AWK/" style="font-size: 10.83px;">AWK</a> <a href="/tags/Akka/" style="font-size: 10.83px;">Akka</a> <a href="/tags/Dockerfile/" style="font-size: 20px;">Dockerfile</a> <a href="/tags/Docker命令/" style="font-size: 19.17px;">Docker命令</a> <a href="/tags/Docker环境/" style="font-size: 15px;">Docker环境</a> <a href="/tags/ELK/" style="font-size: 16.67px;">ELK</a> <a href="/tags/ElasticSearch/" style="font-size: 10.83px;">ElasticSearch</a> <a href="/tags/Elasticsearch/" style="font-size: 12.5px;">Elasticsearch</a> <a href="/tags/Flume/" style="font-size: 17.5px;">Flume</a> <a href="/tags/Git命令/" style="font-size: 13.33px;">Git命令</a> <a href="/tags/Go/" style="font-size: 14.17px;">Go</a> <a href="/tags/HBase/" style="font-size: 10px;">HBase</a> <a href="/tags/HDFS/" style="font-size: 18.33px;">HDFS</a> <a href="/tags/Hadoop/" style="font-size: 10px;">Hadoop</a> <a href="/tags/Hadoop原理架构体系/" style="font-size: 13.33px;">Hadoop原理架构体系</a> <a href="/tags/Hive/" style="font-size: 16.67px;">Hive</a> <a href="/tags/JVM/" style="font-size: 11.67px;">JVM</a> <a href="/tags/Java-Web，Socket，Python/" style="font-size: 10px;">Java Web，Socket，Python</a> <a href="/tags/Jenkins环境/" style="font-size: 10px;">Jenkins环境</a> <a href="/tags/Kafka/" style="font-size: 15.83px;">Kafka</a> <a href="/tags/Kibana/" style="font-size: 14.17px;">Kibana</a> <a href="/tags/Linux命令/" style="font-size: 12.5px;">Linux命令</a> <a href="/tags/Logstash/" style="font-size: 15.83px;">Logstash</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/MapReduce/" style="font-size: 11.67px;">MapReduce</a> <a href="/tags/Maven配置/" style="font-size: 11.67px;">Maven配置</a> <a href="/tags/MongoDB/" style="font-size: 11.67px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Shadowsocks/" style="font-size: 10px;">Shadowsocks</a> <a href="/tags/Shell/" style="font-size: 16.67px;">Shell</a> <a href="/tags/Spring/" style="font-size: 10.83px;">Spring</a> <a href="/tags/Storm/" style="font-size: 12.5px;">Storm</a> <a href="/tags/Zookeeper/" style="font-size: 12.5px;">Zookeeper</a> <a href="/tags/其他/" style="font-size: 10px;">其他</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/birdben">我的CSDN的博客</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">birdben</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/images/logo.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">birdben</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/birdben" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-ELK/ELK学习（二）ELK利用GeoIP进行地理定位" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/23/ELK/ELK学习（二）ELK利用GeoIP进行地理定位/" class="article-date">
  	<time datetime="2017-01-23T12:15:20.000Z" itemprop="datePublished">2017-01-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ELK学习（二）ELK利用GeoIP进行地理定位
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ELK/">ELK</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Log/">Log</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>上一篇我们对Nginx的access.log进行了初步的解析和提取字段处理，如果想进一步对客户端的IP来源进行分析和地理定位，我们需要借助第三方库GeoIP来进行地理定位。</p>
<h3 id="GeoIP的使用"><a href="#GeoIP的使用" class="headerlink" title="GeoIP的使用"></a>GeoIP的使用</h3><p>这里要说明一下GeoIP是一个免费的IP定位数据库，现在目前有两个版本GeoIP和GeoIP2</p>
<p>GeoIP官网地址：</p>
<ul>
<li><a href="https://www.maxmind.com/zh/home" target="_blank" rel="external">https://www.maxmind.com/zh/home</a></li>
</ul>
<p>这里GeoIP和GeoIP2我都尝试过了，使用GeoIP2是因为GeoIP不支持IPv6，开始access.log日志的IP使用的IPv6，但是ES 2.x版本也只支持IPv4类型，所以为了简单把access.log日志的IP改为了IPv4。下面说一下GeoIP和GeoIP2的安装和使用</p>
<h5 id="安装GeoIP数据库"><a href="#安装GeoIP数据库" class="headerlink" title="安装GeoIP数据库"></a>安装GeoIP数据库</h5><p>GeoIP（免费版叫GeoLite）数据库下载地址</p>
<ul>
<li><a href="http://dev.maxmind.com/zh-hans/geoip/legacy/geolite/" target="_blank" rel="external">http://dev.maxmind.com/zh-hans/geoip/legacy/geolite/</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget http://geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz</div><div class="line">gunzip GeoLiteCity.dat.gz</div><div class="line"># 将数据库文件移动到Logstash的安装目录下</div><div class="line">mv GeoLiteCity.dat /usr/local/logstash/geoip/</div></pre></td></tr></table></figure>
<h5 id="Logstash配置文件中指定GeoIP数据库文件"><a href="#Logstash配置文件中指定GeoIP数据库文件" class="headerlink" title="Logstash配置文件中指定GeoIP数据库文件"></a>Logstash配置文件中指定GeoIP数据库文件</h5><p>Logstash默认是安装了logstash-filter-geoip插件的，所以可以直接使用下面的配置。我们继续上一篇的Logstash配置文件修改如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">if [type] == &quot;nginx_access&quot; &#123;</div><div class="line">	grok &#123;</div><div class="line">	    match =&gt; &#123;</div><div class="line">	        &quot;message&quot; =&gt; &quot;%&#123;NGINX_ACCESS_LOGS&#125;&quot;</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	if &quot;_grokparsefailure&quot; in [tags] &#123;</div><div class="line">	    drop &#123; &#125;</div><div class="line">	&#125;</div><div class="line">	# 将client_ip为&quot;-&quot;的转换成&quot;0.0.0.0&quot;，或者直接删除client_ip字段，两种方式的效果都一样，如果IP地址是&quot;-&quot;就会删除client_ip字段，否则geoip转换会报错</div><div class="line">	if [client_ip] == &quot;-&quot; &#123;</div><div class="line">	    mutate &#123;</div><div class="line">	        replace =&gt; &#123; &quot;client_ip&quot; =&gt; &quot;0.0.0.0&quot; &#125;</div><div class="line">	        # remove_field =&gt; [ &quot;client_ip&quot; ]</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	# 这里是geoip指定字段的用法，不适用于geoip2</div><div class="line">	geoip &#123;</div><div class="line">		source =&gt; &quot;client_ip&quot;</div><div class="line">		target =&gt; &quot;geoip&quot;</div><div class="line">		# 这里指定好解压后GeoIP数据库文件的位置</div><div class="line">		database =&gt; &quot;/usr/local/logstash/geoip/GeoLiteCity.dat&quot;</div><div class="line">		# 直接使用location字段即可，不需要add_field和remove_field，除非不想使用location这个名字把字段换成别的名字</div><div class="line">		# 添加自己的坐标字段名称my_location</div><div class="line">		# add_field =&gt; [ &quot;[geoip][my_location]&quot;, &quot;%&#123;[geoip][longitude]&#125;&quot; ]</div><div class="line">		# add_field =&gt; [ &quot;[geoip][my_location]&quot;, &quot;%&#123;[geoip][latitude]&#125;&quot;  ]</div><div class="line">		# 指定保留geoip的字段，注意geoip和geoip2字段的区别</div><div class="line">		# fields =&gt; [&quot;country_name&quot;, &quot;country_code2&quot;,&quot;region_name&quot;, &quot;city_name&quot;, &quot;real_region_name&quot;, &quot;latitude&quot;, &quot;longitude&quot;]</div><div class="line">		# remove_field =&gt; [ &quot;[geoip][longitude]&quot;, &quot;[geoip][latitude]&quot; ]</div><div class="line">	&#125;</div><div class="line">	mutate &#123;</div><div class="line">		# 使用自己的坐标字段名称my_location</div><div class="line">		# convert =&gt; [ &quot;[geoip][my_location]&quot;, &quot;float&quot; ]</div><div class="line">		convert =&gt; [ &quot;[geoip][location]&quot;, &quot;float&quot; ]</div><div class="line">		# 将request_time和upstream_response_time转换成float，否则ES查询出来的是string类型</div><div class="line">		convert =&gt; [ &quot;[request_time]&quot;, &quot;float&quot; ]</div><div class="line">		convert =&gt; [ &quot;[upstream_response_time]&quot;, &quot;float&quot; ]</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="GeoIP的格式"><a href="#GeoIP的格式" class="headerlink" title="GeoIP的格式"></a>GeoIP的格式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">geoip.city_name：城市名称</div><div class="line">geoip.continent_code：洲际编码</div><div class="line">geoip.country_code2：国家编码，国际域名缩写</div><div class="line">geoip.country_code3：国家编码，国际域名缩写</div><div class="line">geoip.country_name：国家名称</div><div class="line">geoip.ip：IP地址</div><div class="line">* geoip.region_name：中国区域编码</div><div class="line">* geoip.real_region_name：中国区域名称</div><div class="line">geoip.timezone：时区</div><div class="line">geoip.location：经纬度坐标</div><div class="line">geoip.latitude：纬度坐标</div><div class="line">geoip.longitude：经度坐标</div></pre></td></tr></table></figure>
<h5 id="安装GeoIP2数据库"><a href="#安装GeoIP2数据库" class="headerlink" title="安装GeoIP2数据库"></a>安装GeoIP2数据库</h5><p>GeoIP2（免费版叫GeoLite2）数据库下载地址</p>
<ul>
<li><a href="http://dev.maxmind.com/zh-hans/geoip/geoip2/geolite2-开源数据库/" target="_blank" rel="external">http://dev.maxmind.com/zh-hans/geoip/geoip2/geolite2-开源数据库/</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.mmdb.gz</div><div class="line">gunzip GeoLite2-City.mmdb.gz</div><div class="line"># 将数据库文件移动到Logstash的安装目录下</div><div class="line">mv GeoLite2-City.mmdb /usr/local/logstash/geoip/</div></pre></td></tr></table></figure>
<h5 id="Logstash配置文件中指定GeoIP2数据库文件"><a href="#Logstash配置文件中指定GeoIP2数据库文件" class="headerlink" title="Logstash配置文件中指定GeoIP2数据库文件"></a>Logstash配置文件中指定GeoIP2数据库文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ cd $&#123;LS_HOME&#125;/bin</div><div class="line">$ logstash-plugin install logstash-filter-geoip2</div></pre></td></tr></table></figure>
<p>这里需要单独安装geoip2插件，因为geoip2插件不是Logstash的官方插件。不使用geoip是因为对IPv6支持的不好，但是ES 2.x版本也只支持IPv4，不支持IPv6类型存储，所以后来只是将access.log的IP地址改为IPv4了。这里只是介绍下如何使用GeoIP2。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">if [type] == &quot;nginx_access&quot; &#123;</div><div class="line">	grok &#123;</div><div class="line">	    match =&gt; &#123;</div><div class="line">	        &quot;message&quot; =&gt; &quot;%&#123;NGINX_ACCESS_LOGS&#125;&quot;</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	if &quot;_grokparsefailure&quot; in [tags] &#123;</div><div class="line">	    drop &#123; &#125;</div><div class="line">	&#125;</div><div class="line">	# 将client_ip为&quot;-&quot;的转换成&quot;0.0.0.0&quot;，或者直接删除client_ip字段，两种方式的效果都一样，如果IP地址是&quot;-&quot;就会删除client_ip字段，否则geoip转换会报错</div><div class="line">	if [client_ip] == &quot;-&quot; &#123;</div><div class="line">	    mutate &#123;</div><div class="line">	        replace =&gt; &#123; &quot;client_ip&quot; =&gt; &quot;0.0.0.0&quot; &#125;</div><div class="line">	        # remove_field =&gt; [ &quot;client_ip&quot; ]</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	geoip2 &#123;</div><div class="line">	    source =&gt; &quot;client_ip&quot;</div><div class="line">	    target =&gt; &quot;geoip&quot;</div><div class="line">	    # 这里指定好解压后GeoIP数据库文件的位置</div><div class="line">	    database =&gt; &quot;/usr/local/logstash/geoip/GeoLite2-City.mmdb&quot;</div><div class="line">	    # 这里是geoip2指定字段的用法</div><div class="line">	    # fields =&gt; [&quot;city_name&quot;, &quot;continent_code&quot;, &quot;country_code2&quot;, &quot;country_code3&quot;, &quot;country_name&quot;, &quot;dma_code&quot;, &quot;ip&quot;, &quot;postal_code&quot;, &quot;region_name&quot;, &quot;region_code&quot;, &quot;timezone&quot;, &quot;location&quot;]</div><div class="line">	&#125;</div><div class="line">	mutate &#123;</div><div class="line">		convert =&gt; [ &quot;[geoip][location]&quot;, &quot;float&quot; ]</div><div class="line">		# 将request_time和upstream_response_time转换成float，否则ES查询出来的是string类型</div><div class="line">		convert =&gt; [ &quot;[request_time]&quot;, &quot;float&quot; ]</div><div class="line">		convert =&gt; [ &quot;[upstream_response_time]&quot;, &quot;float&quot; ]</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意这里的field不能直接用geoip插件的写法，因为有一些字段在geoip2中已经被去掉了，例如：real_region_name，否则会报如下错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Unknown error while looking up GeoIP data &#123;:exception=&gt;#&lt;Exception: [real_region_name] is not a supported field option.&gt;, :field=&gt;&quot;client_ip&quot;, :event=&gt;#&lt;LogStash::Event:0x4b6443d9 @metadata=&#123;&quot;path&quot;=&gt;&quot;/home/yunyu/Downloads/access.log&quot;&#125;, @accessors=#&lt;LogStash::Util::Accessors:0x213c01d</div></pre></td></tr></table></figure>
<p>下面是GeoIP2的格式，可以对比一下GeoIP的格式，不同的地方用*号标识出来了。</p>
<h5 id="GeoIP2的格式"><a href="#GeoIP2的格式" class="headerlink" title="GeoIP2的格式"></a>GeoIP2的格式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">geoip.city_name：城市名称</div><div class="line">geoip.continent_code：洲际编码</div><div class="line">geoip.country_code2：国家编码，国际域名缩写</div><div class="line">geoip.country_code3：国家编码，国际域名缩写</div><div class="line">geoip.country_name：国家名称</div><div class="line">* geoip.dma_code：指定市场区域，Designated Market Area（DMA）</div><div class="line">geoip.ip：IP地址</div><div class="line">* geoip.postal_code：邮政编码</div><div class="line">* geoip.region_code：中国区域编码</div><div class="line">* geoip.region_name：中国区域名称</div><div class="line">geoip.timezone：时区</div><div class="line">geoip.location：经纬度坐标</div><div class="line">geoip.latitude：纬度坐标</div><div class="line">geoip.longitude：经度坐标</div></pre></td></tr></table></figure>
<h3 id="ES的索引Template模板"><a href="#ES的索引Template模板" class="headerlink" title="ES的索引Template模板"></a>ES的索引Template模板</h3><p>引用GeoIP之后，对应的ES的索引Template模板也有相应的变化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;template&quot;: &quot;nginx_access_logs_index_*&quot;,</div><div class="line">  &quot;order&quot;:0,</div><div class="line">  &quot;settings&quot;: &#123;</div><div class="line">      &quot;index.number_of_replicas&quot;: &quot;1&quot;,</div><div class="line">      &quot;index.number_of_shards&quot;: &quot;5&quot;,</div><div class="line">      &quot;index.refresh_interval&quot;: &quot;10s&quot;</div><div class="line">  &#125;,</div><div class="line">  &quot;mappings&quot;: &#123;</div><div class="line">    &quot;_default_&quot;: &#123;</div><div class="line">      &quot;_all&quot;: &#123;</div><div class="line">        &quot;enabled&quot;: false</div><div class="line">      &#125;,</div><div class="line">      &quot;dynamic_templates&quot;: [</div><div class="line">        &#123;</div><div class="line">          &quot;my_string&quot;: &#123;</div><div class="line">            &quot;match_mapping_type&quot;: &quot;string&quot;,</div><div class="line">            &quot;mapping&quot;: &#123;</div><div class="line">              &quot;type&quot;: &quot;string&quot;,</div><div class="line">              &quot;fields&quot;: &#123;</div><div class="line">                &quot;raw&quot;: &#123;</div><div class="line">                  &quot;type&quot;: &quot;string&quot;,</div><div class="line">                  &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">                &#125;</div><div class="line">              &#125;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;,</div><div class="line">    &quot;nginx_access&quot;: &#123;</div><div class="line">      &quot;properties&quot;: &#123;</div><div class="line">        &quot;ident&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;auth&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;client_ip&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;ip&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;client_timestamp&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;http_method&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;http_version&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;url&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;analyzer&quot;: &quot;ik&quot;,</div><div class="line">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;,</div><div class="line">          &quot;fields&quot;: &#123;</div><div class="line">            &quot;raw&quot;: &#123;</div><div class="line">              &quot;type&quot;: &quot;string&quot;,</div><div class="line">              &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &quot;refer_url&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;analyzer&quot;: &quot;ik&quot;,</div><div class="line">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;,</div><div class="line">          &quot;fields&quot;: &#123;</div><div class="line">            &quot;raw&quot;: &#123;</div><div class="line">              &quot;type&quot;: &quot;string&quot;,</div><div class="line">              &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &quot;status_code&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;http_bytes&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;ua&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;analyzer&quot;: &quot;ik&quot;,</div><div class="line">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;,</div><div class="line">          &quot;fields&quot;: &#123;</div><div class="line">            &quot;raw&quot;: &#123;</div><div class="line">              &quot;type&quot;: &quot;string&quot;,</div><div class="line">              &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &quot;device_id&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;sdk_version&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;geoip&quot;: &#123;</div><div class="line">          &quot;dynamic&quot;: true,</div><div class="line">          &quot;type&quot;: &quot;object&quot;,</div><div class="line">          &quot;properties&quot;: &#123;</div><div class="line">            &quot;location&quot;: &#123;</div><div class="line">              &quot;type&quot;: &quot;geo_point&quot;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        &quot;host&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;path&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;type&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;@timestamp&quot;: &#123;</div><div class="line">          &quot;format&quot;: &quot;strict_date_optional_time||epoch_millis&quot;,</div><div class="line">          &quot;type&quot;: &quot;date&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;@version&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;string&quot;,</div><div class="line">          &quot;index&quot;: &quot;not_analyzed&quot;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里添加了一个geoip字段，并且使用dynamic，这样允许Logstash的geoip插件将解析后的详细字段也保存到ES索引中。这里geoip插件解析出来会带有一个location字段，这个字段就是经纬度的坐标点，所以这里设置geoip.location字段的类型是geo_point。</p>
<p>从Logstash的1.3.0版本开始，如果GeoIP查询返回纬度和经度，则会创建一个[geoip] [location]字段。 该字段存储为GeoJSON格式。 此外，弹性搜索输出提供的默认Elasticsearch模板将[geoip] [location]字段映射到Elasticsearch geo_point。</p>
<p>以下是elastic.co官方文档对于geo_point类型的解释</p>
<h5 id="用于索引字段"><a href="#用于索引字段" class="headerlink" title="用于索引字段"></a>用于索引字段</h5><p>geo_point映射将索引具有lat，lon格式的单个字段。lat_lon选项可以设置为也将.lat和.lon作为数字字段索引，geohash可以设置为true以索引.geohash值。</p>
<p>一个好的做法是启用索引lat_lon，因为geo距离和边界框过滤器可以使用内存检查或使用索引的lat lon值执行，并且它实际上取决于哪个数据集执行得更好。请注意，索引lat lon只有当字段有一个地理点值，而不是多个值时才有意义。</p>
<h5 id="Geohashes"><a href="#Geohashes" class="headerlink" title="Geohashes"></a>Geohashes</h5><p>地理散列是一种纬度/经度编码的形式，它将地球分成网格。此网格中的每个单元格都由geohash字符串表示。每个单元又可以被进一步细分成由较长串表示的较小单元。因此，geohash越长，单元格越小（从而更精确）。</p>
<p>因为geohash只是字符串，它们可以像任何其他字符串一样存储在倒排索引中，这使得查询非常有效。</p>
<p>如果启用geohash选项，geohash“子字段”将被索引为，例如pin.geohash。geohash的长度由geohash_precision参数控制，geohash_precision参数可以设置为绝对长度（例如12，默认值）或距离（例如1km）。</p>
<p>更有用的是，将geohash_prefix选项设置为true不仅可以索引geohash值，还可以索引所有包围的单元格。例如，u30的geohash将被索引为[u，u3，u30]。此选项可以由Geohash单元格过滤器用于非常有效地查找特定单元格中的地理位置。</p>
<p>geo_point类型支持4种方式，下面是官网给出的例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"># mapping类型是geo_point</div><div class="line">PUT my_index</div><div class="line">&#123;</div><div class="line">  &quot;mappings&quot;: &#123;</div><div class="line">    &quot;my_type&quot;: &#123;</div><div class="line">      &quot;properties&quot;: &#123;</div><div class="line">        &quot;location&quot;: &#123;</div><div class="line">          &quot;type&quot;: &quot;geo_point&quot;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 方式1</div><div class="line">PUT my_index/my_type/1</div><div class="line">&#123;</div><div class="line">  &quot;text&quot;: &quot;Geo-point as an object&quot;,</div><div class="line">  &quot;location&quot;: &#123; </div><div class="line">    &quot;lat&quot;: 41.12,</div><div class="line">    &quot;lon&quot;: -71.34</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 方式2</div><div class="line">PUT my_index/my_type/2</div><div class="line">&#123;</div><div class="line">  &quot;text&quot;: &quot;Geo-point as a string&quot;,</div><div class="line">  &quot;location&quot;: &quot;41.12,-71.34&quot; </div><div class="line">&#125;</div><div class="line"></div><div class="line"># 方式3</div><div class="line">PUT my_index/my_type/3</div><div class="line">&#123;</div><div class="line">  &quot;text&quot;: &quot;Geo-point as a geohash&quot;,</div><div class="line">  &quot;location&quot;: &quot;drm3btev3e86&quot; </div><div class="line">&#125;</div><div class="line"></div><div class="line"># 方式4</div><div class="line">PUT my_index/my_type/4</div><div class="line">&#123;</div><div class="line">  &quot;text&quot;: &quot;Geo-point as an array&quot;,</div><div class="line">  &quot;location&quot;: [ -71.34, 41.12 ] </div><div class="line">&#125;</div><div class="line"></div><div class="line"># 查询方式</div><div class="line">GET my_index/_search</div><div class="line">&#123;</div><div class="line">  &quot;query&quot;: &#123;</div><div class="line">    &quot;geo_bounding_box&quot;: &#123; </div><div class="line">      &quot;location&quot;: &#123;</div><div class="line">        &quot;top_left&quot;: &#123;</div><div class="line">          &quot;lat&quot;: 42,</div><div class="line">          &quot;lon&quot;: -72</div><div class="line">        &#125;,</div><div class="line">        &quot;bottom_right&quot;: &#123;</div><div class="line">          &quot;lat&quot;: 40,</div><div class="line">          &quot;lon&quot;: -74</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以下是翻译自elastic.co官方文档</p>
<p>说明：</p>
<ul>
<li>方式1：Geo-point表示为一个object，具有lat和lon两个key</li>
<li>方式2：Geo-point表示为一个string，格式为”lat,lon”</li>
<li>方式3：Geo-point表示为geohash</li>
<li>方式4：Geo-point表示为一个array，格式为: [lon, lat]</li>
<li>查询方式：地理边界框查询，它查找落在框内的所有geo-points</li>
</ul>
<p>注意：</p>
<p>string方式的geo-points顺序是lat,lon，而数组方式的geo-points顺序是反过来的lon,lat。最初，lat,lon用于数组和字符串，但是数组格式早期改变以符合GeoJSON使用的格式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Please note that string geo-points are ordered as lat,lon, while array geo-points are ordered as the reverse: lon,lat.</div><div class="line"></div><div class="line">Originally, lat,lon was used for both array and string, but the array format was changed early on to conform to the format used by GeoJSON.</div></pre></td></tr></table></figure>
<h3 id="Kibana配置TileMap"><a href="#Kibana配置TileMap" class="headerlink" title="Kibana配置TileMap"></a>Kibana配置TileMap</h3><h5 id="创建TileMap视图"><a href="#创建TileMap视图" class="headerlink" title="创建TileMap视图"></a>创建TileMap视图</h5><p>在Visualization中选择创建TileMap</p>
<p><img src="http://img.blog.csdn.net/20170124100943166?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmlyZGJlbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="配置TileMap"></p>
<h5 id="TileMap配置后的效果图"><a href="#TileMap配置后的效果图" class="headerlink" title="TileMap配置后的效果图"></a>TileMap配置后的效果图</h5><p>然后在索引中选择geoip.location字段，如下图左边所示。注意：我这里替换成了高德地图后的效果，具体可以参考Kibana系列的文章。</p>
<p><img src="http://img.blog.csdn.net/20170124101512772?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmlyZGJlbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="ChinaMap"></p>
<h5 id="配置错误处理"><a href="#配置错误处理" class="headerlink" title="配置错误处理"></a>配置错误处理</h5><p>如果配置的过程中报错”No Compatible Fields: The “[nginx_access_logs<em>index</em>*]” index pattern does not contain any of the following field types: geo_point”</p>
<p>错误原因：这个错误是因为我们的geoip的location字段类型不是geo_point，之前尝试Logstash写入数据到ES的时候没有在nginx_access_logs<em>index</em>*索引模板中明确的指定geoip.location的类型，所以默认使用的dynamic_templates的配置，动态创建出来的geoip.location字段是string类型的，所以需要在ES的模板中指定好geoip.location字段的类型是geo_point。</p>
<p><img src="http://img.blog.csdn.net/20170123230821712?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmlyZGJlbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="Geohash错误"></p>
<p>参考文章：</p>
<ul>
<li><a href="https://www.maxmind.com/zh/home" target="_blank" rel="external">https://www.maxmind.com/zh/home</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.4/ip.html" target="_blank" rel="external">https://www.elastic.co/guide/en/elasticsearch/reference/2.4/ip.html</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.4/geo-point.html" target="_blank" rel="external">https://www.elastic.co/guide/en/elasticsearch/reference/2.4/geo-point.html</a></li>
<li><a href="https://www.elastic.co/guide/en/logstash/2.4/plugins-filters-geoip.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/2.4/plugins-filters-geoip.html</a></li>
<li><a href="http://kibana.logstash.es/content/logstash/plugins/filter/geoip.html" target="_blank" rel="external">http://kibana.logstash.es/content/logstash/plugins/filter/geoip.html</a></li>
<li><a href="https://github.com/logstash-plugins/logstash-filter-geoip/issues/12">https://github.com/logstash-plugins/logstash-filter-geoip/issues/12</a></li>
<li><a href="http://dev.maxmind.com/geoip/legacy/codes/iso3166/" target="_blank" rel="external">http://dev.maxmind.com/geoip/legacy/codes/iso3166/</a></li>
<li><a href="http://www.stats.gov.cn/tjsj/tjbz/xzqhdm/" target="_blank" rel="external">http://www.stats.gov.cn/tjsj/tjbz/xzqhdm/</a></li>
<li><a href="http://blog.csdn.net/yanggd1987/article/details/50469113" target="_blank" rel="external">http://blog.csdn.net/yanggd1987/article/details/50469113</a></li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/01/24/ELK/ELK学习（三）ELK处理URL参数/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          ELK学习（三）ELK处理URL参数
        
      </div>
    </a>
  
  
    <a href="/2017/01/23/ELK/ELK学习（一）ELK收集Nginx日志/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">ELK学习（一）ELK收集Nginx日志</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>








</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 birdben
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>



<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82900755-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>