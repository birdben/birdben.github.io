<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Kafka学习（六）Kafka集群的迁移与扩容 | birdben</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Kafka的集群扩容实际上就是把Topic的Partition移动到新加的集群节点上。我们只需要copy一份Kafka的安装目录到新的节点机器上，修改一下相关配置文件（broker.id，logs.dir等等），但是新添加的Kafka节点机器是不会自动分配数据的，所以需要我们手动操作。
Kafka的扩容可以细分为以下三种：

增加节点
增加Topic副本
增加分区

具体的步骤有两种方式:

通过">
<meta property="og:type" content="article">
<meta property="og:title" content="Kafka学习（六）Kafka集群的迁移与扩容">
<meta property="og:url" content="https://github.com/birdben/2016/12/27/Kafka/Kafka学习（六）Kafka集群的迁移与扩容/index.html">
<meta property="og:site_name" content="birdben">
<meta property="og:description" content="Kafka的集群扩容实际上就是把Topic的Partition移动到新加的集群节点上。我们只需要copy一份Kafka的安装目录到新的节点机器上，修改一下相关配置文件（broker.id，logs.dir等等），但是新添加的Kafka节点机器是不会自动分配数据的，所以需要我们手动操作。
Kafka的扩容可以细分为以下三种：

增加节点
增加Topic副本
增加分区

具体的步骤有两种方式:

通过">
<meta property="og:updated_time" content="2017-05-07T10:48:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kafka学习（六）Kafka集群的迁移与扩容">
<meta name="twitter:description" content="Kafka的集群扩容实际上就是把Topic的Partition移动到新加的集群节点上。我们只需要copy一份Kafka的安装目录到新的节点机器上，修改一下相关配置文件（broker.id，logs.dir等等），但是新添加的Kafka节点机器是不会自动分配数据的，所以需要我们手动操作。
Kafka的扩容可以细分为以下三种：

增加节点
增加Topic副本
增加分区

具体的步骤有两种方式:

通过">
  
    <link rel="alternative" href="/atom.xml" title="birdben" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
<script type="text/javascript">
var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260188951'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1260188951' type='text/javascript'%3E%3C/script%3E"));
</script>

</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/images/logo.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">birdben</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/birdben" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AWK/" style="font-size: 10.83px;">AWK</a> <a href="/tags/Akka/" style="font-size: 10.83px;">Akka</a> <a href="/tags/Dockerfile/" style="font-size: 20px;">Dockerfile</a> <a href="/tags/Docker命令/" style="font-size: 19.17px;">Docker命令</a> <a href="/tags/Docker环境/" style="font-size: 15px;">Docker环境</a> <a href="/tags/ELK/" style="font-size: 16.67px;">ELK</a> <a href="/tags/ElasticSearch/" style="font-size: 10.83px;">ElasticSearch</a> <a href="/tags/Elasticsearch/" style="font-size: 12.5px;">Elasticsearch</a> <a href="/tags/Flume/" style="font-size: 17.5px;">Flume</a> <a href="/tags/Git命令/" style="font-size: 13.33px;">Git命令</a> <a href="/tags/Go/" style="font-size: 14.17px;">Go</a> <a href="/tags/HBase/" style="font-size: 10px;">HBase</a> <a href="/tags/HDFS/" style="font-size: 18.33px;">HDFS</a> <a href="/tags/Hadoop/" style="font-size: 10px;">Hadoop</a> <a href="/tags/Hadoop原理架构体系/" style="font-size: 13.33px;">Hadoop原理架构体系</a> <a href="/tags/Hive/" style="font-size: 16.67px;">Hive</a> <a href="/tags/JVM/" style="font-size: 11.67px;">JVM</a> <a href="/tags/Java-Web，Socket，Python/" style="font-size: 10px;">Java Web，Socket，Python</a> <a href="/tags/Jenkins环境/" style="font-size: 10px;">Jenkins环境</a> <a href="/tags/Kafka/" style="font-size: 15.83px;">Kafka</a> <a href="/tags/Kibana/" style="font-size: 14.17px;">Kibana</a> <a href="/tags/Linux命令/" style="font-size: 12.5px;">Linux命令</a> <a href="/tags/Logstash/" style="font-size: 15.83px;">Logstash</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/MapReduce/" style="font-size: 11.67px;">MapReduce</a> <a href="/tags/Maven配置/" style="font-size: 11.67px;">Maven配置</a> <a href="/tags/MongoDB/" style="font-size: 11.67px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Shadowsocks/" style="font-size: 10px;">Shadowsocks</a> <a href="/tags/Shell/" style="font-size: 16.67px;">Shell</a> <a href="/tags/Spring/" style="font-size: 10.83px;">Spring</a> <a href="/tags/Storm/" style="font-size: 12.5px;">Storm</a> <a href="/tags/Zookeeper/" style="font-size: 12.5px;">Zookeeper</a> <a href="/tags/其他/" style="font-size: 10px;">其他</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/birdben">我的CSDN的博客</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">birdben</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/images/logo.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">birdben</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/birdben" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-Kafka/Kafka学习（六）Kafka集群的迁移与扩容" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/27/Kafka/Kafka学习（六）Kafka集群的迁移与扩容/" class="article-date">
  	<time datetime="2016-12-26T17:02:11.000Z" itemprop="datePublished">2016-12-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Kafka学习（六）Kafka集群的迁移与扩容
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kafka/">Kafka</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/MQ/">MQ</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Kafka的集群扩容实际上就是把Topic的Partition移动到新加的集群节点上。我们只需要copy一份Kafka的安装目录到新的节点机器上，修改一下相关配置文件（broker.id，logs.dir等等），但是新添加的Kafka节点机器是不会自动分配数据的，所以需要我们手动操作。</p>
<p>Kafka的扩容可以细分为以下三种：</p>
<ul>
<li>增加节点</li>
<li>增加Topic副本</li>
<li>增加分区</li>
</ul>
<p>具体的步骤有两种方式:</p>
<ul>
<li>通过–topics-to-move-json-file和–broker-list批量生成新的Topic分区信息，然后根据该信息执行转移操作。</li>
<li>手动写要移动的topic信息，更灵活，但是在大量Topic和Partition的情况下非常繁琐并且容易出错。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">kafka-reassign-partitions.sh命令的三种模式</div><div class="line"></div><div class="line">generate模式：给需要重新分配的Topic，自动生成reassign plan（执行计划），但并不执行</div><div class="line">execute模式：根据指定的reassign plan（json文件）重新分配partition或者replication</div><div class="line">verify模式：检查重新分配是否完成</div><div class="line"></div><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --topics-to-move-json-file json_file --broker-list &quot;brokerIds&quot; --generate</div><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file json_file --execute</div><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file json_file --verify</div></pre></td></tr></table></figure>
<h3 id="Kafka动态增加节点（Node）"><a href="#Kafka动态增加节点（Node）" class="headerlink" title="Kafka动态增加节点（Node）"></a>Kafka动态增加节点（Node）</h3><p>新添加的Kafka节点机器是不会自动分配数据的，所以无法分担集群的负载，除非我们新建一个Topic，此时新的Topic会使用新添加的Kafka节点机器。如果我们想新添加的Kafka节点机器能够分担集群存储，需要手动将部分分区移动到新添加的Kafka节点机器上。</p>
<p>我们原来的Kafka节点分别是0，1，2，现在要加入3，4两个新节点</p>
<p>topicMove.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;topics&quot;:[</div><div class="line">        &#123;&quot;topic&quot;:&quot;logstash_test&quot;&#125;</div><div class="line">    ],</div><div class="line">    &quot;version&quot;:1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>生成迁移的计划</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --topics-to-move-json-file topicMove.json --broker-list &quot;0,1,2,3,4&quot; --generate</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[1,2,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[2,1,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[1,2,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,2,1]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:5,&quot;replicas&quot;:[0,1,2]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[2,0,1]&#125;]&#125;</div><div class="line">Proposed partition reassignment configuration</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[2,0,1]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,3,4]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[4,2,3]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,4,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:5,&quot;replicas&quot;:[4,3,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[3,1,2]&#125;]&#125;</div></pre></td></tr></table></figure>
<p>上面是原来的所有partition在各个节点的分布情况，下面是加入4，5两个新节点之后所有partition在各个节点的分布情况</p>
<p>将生成的执行计划保存为add_node.json文件</p>
<p>重新分配partition（其实这里是添加新的节点）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_node.json --execute</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[1,2,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[2,1,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[1,2,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,2,1]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:5,&quot;replicas&quot;:[0,1,2]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[2,0,1]&#125;]&#125;</div><div class="line"></div><div class="line">Save this to use as the --reassignment-json-file option during rollback</div><div class="line">Successfully started reassignment of partitions &#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[4,2,3]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[3,1,2]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:5,&quot;replicas&quot;:[4,3,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,4,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[2,0,1]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,3,4]&#125;]&#125;</div></pre></td></tr></table></figure>
<p>查看执行的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_node.json --verify</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR: Assigned replicas (X,X) don&apos;t match the list of replicas for reassignment (X,X) for partition [logstash_test,1]</div></pre></td></tr></table></figure>
<p>假设出现类似这样的错误，他并不是真的出错，而是指目前仍在复制数据中。再过一段时间再运行verify命令，他就会消失(加入完成拷贝)</p>
<p>当然也可以不使用generate先生成执行计划，而是自己直接手动编辑生成add_node.json文件内容，然后直接execute执行，但是这样容易出错，Kafka节点比较少的时候推荐使用。</p>
<p>注意：其实通过generate的结果我们也可以看出，其实不管是扩容，减容，迁移，其实都是重新分配Topic或者Partition的过程。json文件的内容都是指定Topic下的Partition要移动到哪个Node上。</p>
<h3 id="Kafka动态增加Topic副本（Replication）"><a href="#Kafka动态增加Topic副本（Replication）" class="headerlink" title="Kafka动态增加Topic副本（Replication）"></a>Kafka动态增加Topic副本（Replication）</h3><p>查看当前node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:1	ReplicationFactor:1	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 2	Replicas: 2	Isr: 2</div></pre></td></tr></table></figure>
<p>add_replication.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;version&quot;:1</div><div class="line">    &quot;partitions&quot;:[</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:0,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>重新分配partition（其实这里是添加副本replication）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_replication.json --execute</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[2]&#125;]&#125;</div><div class="line"></div><div class="line">Save this to use as the --reassignment-json-file option during rollback</div><div class="line">Successfully started reassignment of partitions &#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1,2]&#125;]&#125;</div></pre></td></tr></table></figure>
<p>查看执行的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_replication.json --verify</div><div class="line">Status of partition reassignment:</div><div class="line">Reassignment of partition [node_log,0] completed successfully</div></pre></td></tr></table></figure>
<p>如果遇到下面的错误很有可能是json文件格式有错误，仔细检查修正重新运行即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Partitions reassignment failed due to Partition reassignment data file add_replication.json is empty</div><div class="line">kafka.common.AdminCommandFailedException: Partition reassignment data file add_replication.json is empty</div><div class="line">	at kafka.admin.ReassignPartitionsCommand$.executeAssignment(ReassignPartitionsCommand.scala:120)</div><div class="line">	at kafka.admin.ReassignPartitionsCommand$.main(ReassignPartitionsCommand.scala:52)</div><div class="line">	at kafka.admin.ReassignPartitionsCommand.main(ReassignPartitionsCommand.scala)</div></pre></td></tr></table></figure>
<p>查看添加replication后的node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:1	ReplicationFactor:2	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 1,0,2</div></pre></td></tr></table></figure>
<h3 id="Kafka动态增加分区（Parition）"><a href="#Kafka动态增加分区（Parition）" class="headerlink" title="Kafka动态增加分区（Parition）"></a>Kafka动态增加分区（Parition）</h3><p>查看当前node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:1	ReplicationFactor:2	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 1,0,2</div></pre></td></tr></table></figure>
<p>add_partition.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;version&quot;:1,</div><div class="line">    &quot;partitions&quot;:[</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:0,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:1,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:2,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>重新分配partition</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_partition.json --execute</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1,2]&#125;]&#125;</div><div class="line"></div><div class="line">Save this to use as the --reassignment-json-file option during rollback</div><div class="line">[2016-12-30 12:22:17,195] ERROR Skipping reassignment of partition [node_log,1] since it doesn&apos;t exist (kafka.admin.ReassignPartitionsCommand)</div><div class="line">[2016-12-30 12:22:17,207] ERROR Skipping reassignment of partition [node_log,2] since it doesn&apos;t exist (kafka.admin.ReassignPartitionsCommand)</div><div class="line">Successfully started reassignment of partitions &#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1,2]&#125;,&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,1,2]&#125;,&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,1,2]&#125;]&#125;</div></pre></td></tr></table></figure>
<p>查看执行的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_partition.json --verify</div><div class="line">Status of partition reassignment:</div><div class="line">ERROR: Assigned replicas (1,2,0) don&apos;t match the list of replicas for reassignment (0,1,2) for partition [node_log,1]</div><div class="line">ERROR: Assigned replicas (2,0,1) don&apos;t match the list of replicas for reassignment (0,1,2) for partition [node_log,2]</div><div class="line">Reassignment of partition [node_log,0] completed successfully</div><div class="line">Reassignment of partition [node_log,1] failed</div><div class="line">Reassignment of partition [node_log,2] failed</div></pre></td></tr></table></figure>
<p>报错是因为我们只有一个partition0，没有partition1，partition2，所以跳过了重新分配partition的过程。</p>
<p>我们需要先增加partition的数量，我们把partition的数量变成6个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --zookeeper localhost:2181 --alter --topic node_log --partitions 6</div><div class="line">WARNING: If partitions are increased for a topic that has a key, the partition logic or ordering of the messages will be affected</div><div class="line">Adding partitions succeeded!</div></pre></td></tr></table></figure>
<p>查看添加partition后的node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:6	ReplicationFactor:3	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 1,0,2</div><div class="line">	Topic: node_log	Partition: 1	Leader: 1	Replicas: 1,2,0	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 2	Leader: 2	Replicas: 2,0,1	Isr: 2,0,1</div><div class="line">	Topic: node_log	Partition: 3	Leader: 0	Replicas: 0,2,1	Isr: 0,2,1</div><div class="line">	Topic: node_log	Partition: 4	Leader: 1	Replicas: 1,0,2	Isr: 1,0,2</div><div class="line">	Topic: node_log	Partition: 5	Leader: 2	Replicas: 2,1,0	Isr: 2,1,0</div></pre></td></tr></table></figure>
<p>重新执行reassign，然后查看执行状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_partition.json --verify</div><div class="line">Status of partition reassignment:</div><div class="line">Reassignment of partition [node_log,0] completed successfully</div><div class="line">Reassignment of partition [node_log,1] completed successfully</div><div class="line">Reassignment of partition [node_log,2] completed successfully</div></pre></td></tr></table></figure>
<p>重新分配执行完成之后，再次查看node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line"></div><div class="line">Topic:node_log	PartitionCount:6	ReplicationFactor:3	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 1	Leader: 0	Replicas: 0,1,2	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 2	Leader: 0	Replicas: 0,1,2	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 3	Leader: 0	Replicas: 0,2,1	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 4	Leader: 1	Replicas: 1,0,2	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 5	Leader: 2	Replicas: 2,1,0	Isr: 1,2,0</div></pre></td></tr></table></figure>
<p>执行reassign之后，我们发现0-3的partition的leader都是0，这是因为我们之前突然扩展partition到6个，而我们在reassign的之后只指定了0-2的partition的分配，我们修改一下add_partition.json文件如下，将6个partition均匀的分布在我们3个broker节点上，每个partition有2个replication。</p>
<p>add_partition.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;version&quot;:1,</div><div class="line">    &quot;partitions&quot;:[</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:0,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:1,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:2,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                2,</div><div class="line">                0</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:3,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:4,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:5,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                2,</div><div class="line">                0</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再次查看reassign之后的Topic情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:6	ReplicationFactor:2	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1	Isr: 0,1</div><div class="line">	Topic: node_log	Partition: 1	Leader: 1	Replicas: 1,2	Isr: 1,2</div><div class="line">	Topic: node_log	Partition: 2	Leader: 0	Replicas: 2,0	Isr: 0,2</div><div class="line">	Topic: node_log	Partition: 3	Leader: 0	Replicas: 0,1	Isr: 0,1</div><div class="line">	Topic: node_log	Partition: 4	Leader: 1	Replicas: 1,2	Isr: 1,2</div><div class="line">	Topic: node_log	Partition: 5	Leader: 2	Replicas: 2,0	Isr: 0,2</div></pre></td></tr></table></figure>
<p>我们发现还是有点小问题，partition2的leader仍然是0。这里先普及一下assigned replicas和preferred replica</p>
<h4 id="assigned-replicas和preferred-replica"><a href="#assigned-replicas和preferred-replica" class="headerlink" title="assigned replicas和preferred replica"></a>assigned replicas和preferred replica</h4><p>每个partitiion的所有replicas叫做”assigned replicas”，”assigned replicas”中的第一个replicas叫”preferred replica”，刚创建的topic一般”preferred replica”是leader。leader replica负责所有的读写。但随着时间推移，broker可能会停机，会导致leader迁移，导致机群的负载不均衡。</p>
<p>我们这里preferred replica已经是2了，但是leader却不是2，这样我们需要重新选举一下leader，需要使用kafka-preferred-replica-election.sh来调整。</p>
<p>两种操作方式：</p>
<ul>
<li>对所有Topics进行操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ kafka-preferred-replica-election.sh --zookeeper localhost:2181</div></pre></td></tr></table></figure>
<ul>
<li>对某个Topic进行操作（json文件中指定要操作的Topic）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ kafka-preferred-replica-election.sh --zookeeper localhost:2181 --path-to-json-file json_file</div></pre></td></tr></table></figure>
<p>注意：这里我们只需要调整node_log的Topic的partition2的leader。</p>
<p>leaderTopic.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"> &quot;partitions&quot;:</div><div class="line">  [</div><div class="line">    &#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:2&#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>重新选举leader</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ kafka-preferred-replica-election.sh --zookeeper localhost:2181 --path-to-json-file leaderTopic.json</div><div class="line">Successfully started preferred replica election for partitions Set([node_log,2])</div></pre></td></tr></table></figure>
<p>再次查看Topic情况，发现leader也是我们所期望的均匀分配了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:6	ReplicationFactor:2	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1	Isr: 0,1</div><div class="line">	Topic: node_log	Partition: 1	Leader: 1	Replicas: 1,2	Isr: 2,1</div><div class="line">	Topic: node_log	Partition: 2	Leader: 2	Replicas: 2,0	Isr: 2,0</div><div class="line">	Topic: node_log	Partition: 3	Leader: 0	Replicas: 0,1	Isr: 0,1</div><div class="line">	Topic: node_log	Partition: 4	Leader: 1	Replicas: 1,2	Isr: 2,1</div><div class="line">	Topic: node_log	Partition: 5	Leader: 2	Replicas: 2,0	Isr: 0,2</div></pre></td></tr></table></figure>
<p>数据迁移的步骤</p>
<ol>
<li><p>The tool updates the zookeeper path “/admin/reassign_partitions” with the list of topic partitions and (if specified in the Json file) the list of their new assigned replicas.</p>
</li>
<li><p>The controller listens to the path above. When a data change update is triggered, the controller reads the list of topic partitions and their assigned replicas from zookeeper.</p>
</li>
<li><p>For each topic partition, the controller does the following:</p>
</li>
</ol>
<ul>
<li>3.1. Start new replicas in RAR – AR (RAR = Reassigned Replicas, AR = original list of Assigned Replicas)</li>
<li>3.2. Wait until new replicas are in sync with the leader</li>
<li>3.3. If the leader is not in RAR, elect a new leader from RAR</li>
<li>3.4. Stop old replicas AR – RAR</li>
<li>3.5. Write new AR</li>
<li>3.6. Remove partition from the /admin/reassign_partitions path</li>
</ul>
<p>参考文章：</p>
<ul>
<li><a href="http://blog.csdn.net/lsshlsw/article/details/47615747" target="_blank" rel="external">http://blog.csdn.net/lsshlsw/article/details/47615747</a></li>
<li><a href="https://www.iteblog.com/archives/1611" target="_blank" rel="external">https://www.iteblog.com/archives/1611</a></li>
<li><a href="https://www.iteblog.com/archives/1613" target="_blank" rel="external">https://www.iteblog.com/archives/1613</a></li>
<li><a href="https://www.iteblog.com/archives/1614" target="_blank" rel="external">https://www.iteblog.com/archives/1614</a></li>
<li><a href="http://wzktravel.github.io/2015/12/31/kafka-reassign/" target="_blank" rel="external">http://wzktravel.github.io/2015/12/31/kafka-reassign/</a></li>
<li><a href="http://blog.csdn.net/lizhitao/article/details/41441513" target="_blank" rel="external">http://blog.csdn.net/lizhitao/article/details/41441513</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/KAFKA/Replication+tools#Replicationtools-2.PreferredReplicaLeaderElectionTool" target="_blank" rel="external">https://cwiki.apache.org/confluence/display/KAFKA/Replication+tools#Replicationtools-2.PreferredReplicaLeaderElectionTool</a></li>
<li><a href="https://cwiki.apache.org/confluence/pages/diffpages.action?pageId=31819985&amp;originalId=34022604" target="_blank" rel="external">https://cwiki.apache.org/confluence/pages/diffpages.action?pageId=31819985&amp;originalId=34022604</a></li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/12/27/Go/Go学习（二）引用第三方包/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          Go学习（二）引用第三方包
        
      </div>
    </a>
  
  
    <a href="/2016/12/26/Kafka/Kafka学习（五）Kafka数据目录的迁移与扩容/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Kafka学习（五）Kafka数据目录的迁移与扩容</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>








</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 birdben
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>



<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82900755-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>