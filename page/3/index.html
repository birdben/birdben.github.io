<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>birdben</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="birdben">
<meta property="og:url" content="https://github.com/birdben/page/3/index.html">
<meta property="og:site_name" content="birdben">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="birdben">
  
    <link rel="alternative" href="/atom.xml" title="birdben" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
<script type="text/javascript">
var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260188951'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1260188951' type='text/javascript'%3E%3C/script%3E"));
</script>

</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/images/logo.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">birdben</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/birdben" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AWK/" style="font-size: 10.83px;">AWK</a> <a href="/tags/Akka/" style="font-size: 10.83px;">Akka</a> <a href="/tags/Dockerfile/" style="font-size: 20px;">Dockerfile</a> <a href="/tags/Docker命令/" style="font-size: 19.17px;">Docker命令</a> <a href="/tags/Docker环境/" style="font-size: 15px;">Docker环境</a> <a href="/tags/ELK/" style="font-size: 16.67px;">ELK</a> <a href="/tags/ElasticSearch/" style="font-size: 10.83px;">ElasticSearch</a> <a href="/tags/Elasticsearch/" style="font-size: 12.5px;">Elasticsearch</a> <a href="/tags/Flume/" style="font-size: 17.5px;">Flume</a> <a href="/tags/Git命令/" style="font-size: 13.33px;">Git命令</a> <a href="/tags/Go/" style="font-size: 14.17px;">Go</a> <a href="/tags/HBase/" style="font-size: 10px;">HBase</a> <a href="/tags/HDFS/" style="font-size: 18.33px;">HDFS</a> <a href="/tags/Hadoop/" style="font-size: 10px;">Hadoop</a> <a href="/tags/Hadoop原理架构体系/" style="font-size: 13.33px;">Hadoop原理架构体系</a> <a href="/tags/Hive/" style="font-size: 16.67px;">Hive</a> <a href="/tags/JVM/" style="font-size: 11.67px;">JVM</a> <a href="/tags/Java-Web，Socket，Python/" style="font-size: 10px;">Java Web，Socket，Python</a> <a href="/tags/Jenkins环境/" style="font-size: 10px;">Jenkins环境</a> <a href="/tags/Kafka/" style="font-size: 15.83px;">Kafka</a> <a href="/tags/Kibana/" style="font-size: 14.17px;">Kibana</a> <a href="/tags/Linux命令/" style="font-size: 12.5px;">Linux命令</a> <a href="/tags/Logstash/" style="font-size: 15.83px;">Logstash</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/MapReduce/" style="font-size: 11.67px;">MapReduce</a> <a href="/tags/Maven配置/" style="font-size: 11.67px;">Maven配置</a> <a href="/tags/MongoDB/" style="font-size: 11.67px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Shadowsocks/" style="font-size: 10px;">Shadowsocks</a> <a href="/tags/Shell/" style="font-size: 16.67px;">Shell</a> <a href="/tags/Spring/" style="font-size: 10.83px;">Spring</a> <a href="/tags/Storm/" style="font-size: 12.5px;">Storm</a> <a href="/tags/Zookeeper/" style="font-size: 12.5px;">Zookeeper</a> <a href="/tags/其他/" style="font-size: 10px;">其他</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/birdben">我的CSDN的博客</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">birdben</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/images/logo.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">birdben</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/birdben" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-Docker/Docker实战（二十三）Docker安装Shadowsocks" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/19/Docker/Docker实战（二十三）Docker安装Shadowsocks/" class="article-date">
  	<time datetime="2017-01-19T04:01:57.000Z" itemprop="datePublished">2017-01-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/19/Docker/Docker实战（二十三）Docker安装Shadowsocks/">Docker实战（二十三）Docker安装Shadowsocks</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近DO服务器一直没续费到期了，想换个新的VPS服务器又发现原来的翻墙工具Shadowsocks又要重装好麻烦啊。所以想到了用Docker安装一个Shadowsocks镜像的一劳永逸的方式。</p>
<p>Dockerfile文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">############################################</div><div class="line"># version : birdben/shadowsocks:v1</div><div class="line"># desc : 当前版本安装的shadowsocks</div><div class="line">############################################</div><div class="line"># 设置继承自我们创建的 tools 镜像</div><div class="line">FROM birdben/tools:v1</div><div class="line"></div><div class="line"># 下面是一些创建者的基本信息</div><div class="line">MAINTAINER birdben (191654006@163.com)</div><div class="line"></div><div class="line"># 设置环境变量，所有操作都是非交互式的</div><div class="line">ENV DEBIAN_FRONTEND noninteractive</div><div class="line">ENV SSS_USER=shadowsocks</div><div class="line">ENV SSS_SUPERVISOR_LOG_DIR=/var/log/supervisor</div><div class="line">ENV SSS_SHADOWSOCKS_LOG_DIR=/var/log/shadowsocks</div><div class="line"></div><div class="line"># Add a user and make dirs</div><div class="line">RUN set -x \</div><div class="line">    &amp;&amp; useradd $SSS_USER \</div><div class="line">    &amp;&amp; mkdir -p $SSS_SUPERVISOR_LOG_DIR \</div><div class="line">    &amp;&amp; mkdir -p $SSS_SHADOWSOCKS_LOG_DIR \</div><div class="line">    &amp;&amp; chown $SSS_USER:$SSS_USER $SSS_SUPERVISOR_LOG_DIR \</div><div class="line">    &amp;&amp; chown $SSS_USER:$SSS_USER $SSS_SHADOWSOCKS_LOG_DIR \</div><div class="line">    &amp;&amp; chmod 777 /var/run</div><div class="line"></div><div class="line"># 替换 sources.list 的配置文件，并复制配置文件到对应目录下面。</div><div class="line"># 这里使用的AWS国内的源，也可以替换成其他的源（例如：阿里云的源）</div><div class="line">COPY sources.list /etc/apt/sources.list</div><div class="line"></div><div class="line"># 添加 supervisord 的配置文件，并复制配置文件到对应目录下面。（supervisord.conf文件和Dockerfile文件在同一路径）</div><div class="line">COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf</div><div class="line">COPY shadowsocks.json /etc/shadowsocks.json</div><div class="line"></div><div class="line">RUN sudo rm -rf /var/lib/apt/lists/*</div><div class="line">RUN sudo apt-get update</div><div class="line"></div><div class="line">RUN sudo apt-get -y install python-pip</div><div class="line">RUN sudo pip install --upgrade pip</div><div class="line">RUN sudo pip install shadowsocks</div><div class="line"></div><div class="line"># /Users/yunyu/workspace_git/birdDocker/shadowsocks/logs/supervisor:/var/log/supervisor</div><div class="line"># /Users/yunyu/workspace_git/birdDocker/shadowsocks/logs/shadowsocks:/var/log/shadowsocks</div><div class="line"># 这里挂载的路径是birdTracker项目的目录</div><div class="line">VOLUME [&quot;/var/log/supervisor&quot;]</div><div class="line">VOLUME [&quot;/var/log/shadowsocks&quot;]</div><div class="line"></div><div class="line">USER root</div><div class="line"></div><div class="line"># 容器需要开放Shadowsocks的443端口</div><div class="line">EXPOSE 443</div><div class="line"></div><div class="line"># 执行run.sh文件</div><div class="line"># CMD [&quot;/run.sh&quot;]</div><div class="line"># 执行supervisord来同时执行多个命令，使用 supervisord 的可执行路径启动服务。</div><div class="line">CMD [&quot;/usr/bin/supervisord&quot;, &quot;-c&quot;, &quot;/etc/supervisor/supervisord.conf&quot;]</div></pre></td></tr></table></figure>
<p>Dockerfile源文件链接：</p>
<ul>
<li><a href="https://github.com/birdben/birdDocker/blob/master/shadowsocks/Dockerfile">https://github.com/birdben/birdDocker/blob/master/shadowsocks/Dockerfile</a></li>
</ul>
<p>supervisord.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[program:shadowsocks]</div><div class="line">command=ssserver -c /etc/shadowsocks.json</div><div class="line">autostart=true</div><div class="line">autorestart=true</div><div class="line">stderr_logfile = /var/log/shadowsocks/shadowsocks.err</div><div class="line">stdout_logfile = /var/log/shadowsocks/shadowsocks.out</div><div class="line">user=root</div><div class="line">stopsignal=INT</div><div class="line"></div><div class="line">[supervisord]</div><div class="line">nodaemon=true</div><div class="line">user=root</div></pre></td></tr></table></figure>
<p>shadowsocks.json配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;server&quot;:&quot;0.0.0.0&quot;,</div><div class="line">    &quot;server_port&quot;:443,</div><div class="line">    &quot;local_address&quot;:&quot;127.0.0.1&quot;,</div><div class="line">    &quot;local_port&quot;:1080,</div><div class="line">    &quot;password&quot;:&quot;123456&quot;,</div><div class="line">    &quot;timeout&quot;:500,</div><div class="line">    &quot;method&quot;:&quot;aes-256-cfb&quot;,</div><div class="line">    &quot;fast_open&quot;:false</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 配置内容描述</div><div class="line">server : 服务端监听的地址，服务端可填写 0.0.0.0</div><div class="line">server_port : 服务端的端口</div><div class="line">local_address : 本地端监听的地址</div><div class="line">local_port : 本地端的端口</div><div class="line">password : 用于加密的密码</div><div class="line">timeout : 超时时间，单位秒</div><div class="line">method : 默认&quot;aes-256-cfb&quot;，建议chacha20或者rc4-md5，因为这两个速度快</div><div class="line">fast_open : 是否使用 TCP_FASTOPEN, true / false（后面优化部分会打开系统的 TCP_FASTOPEN，所以这里填 true，否则填 false)</div></pre></td></tr></table></figure>
<p>构建Docker镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker build -t &quot;birdben/shadowsocks:v1&quot; .</div></pre></td></tr></table></figure>
<p>运行Docker容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CURRENT_UID=`whoami`</div><div class="line">docker run -itd -p 443:443 -v /Users/yunyu/workspace_git/birdDocker/shadowsocks/logs/shadowsocks:/var/log/shadowsocks -v /Users/yunyu/workspace_git/birdDocker/shadowsocks/logs/supervisor:/var/log/supervisor --name shadowsocks_$&#123;CURRENT_UID&#125; birdben/shadowsocks:v1</div></pre></td></tr></table></figure>
<p>Shadowsocks客户端配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">地址：192.168.99.127</div><div class="line">端口：443</div><div class="line">加密：aes-256-cfb</div><div class="line">密码：123456</div></pre></td></tr></table></figure>
<p>也可以不使用配置文件方式启动，可以在启动的时候指定配置信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ssserver -s 监听地址 -p 服务器端口 -k 密码 -m 加密方法</div><div class="line"></div><div class="line">参数说明：</div><div class="line">-s : 监听的服务器端地址</div><div class="line">-p : 服务器监听端口</div><div class="line">-k : 客户端连接密码</div><div class="line">-m : 加密方式</div><div class="line">--user : 指定启动进程的用户</div><div class="line">--d : 指定运行方式，启动/关闭/重启</div></pre></td></tr></table></figure>
<p>浏览器访问www.google.com就可以看到Shadowsocks的日志中会有访问记录出现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">INFO: loading config from /etc/shadowsocks.json</div><div class="line">2017-02-05 08:19:32 INFO     loading libcrypto from libcrypto.so.1.0.0</div><div class="line">2017-02-05 08:19:32 INFO     starting server at 0.0.0.0:443</div><div class="line">2017-02-05 08:21:46 INFO     connecting www.google.com:443 from 172.17.0.1:54762</div><div class="line">2017-02-05 08:21:46 INFO     connecting www.facebook.com:443 from 172.17.0.1:54766</div></pre></td></tr></table></figure>
<p>参考文章：</p>
<ul>
<li><a href="https://blog.phpgao.com/shadowsocks_on_linux.html" target="_blank" rel="external">https://blog.phpgao.com/shadowsocks_on_linux.html</a></li>
<li><a href="https://blog.phpgao.com/supervisor_shadowsocks.html" target="_blank" rel="external">https://blog.phpgao.com/supervisor_shadowsocks.html</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker环境/">Docker环境</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Docker/">Docker</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Others/我的MacBook工具" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/18/Others/我的MacBook工具/" class="article-date">
  	<time datetime="2017-01-18T12:46:40.000Z" itemprop="datePublished">2017-01-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/18/Others/我的MacBook工具/">我的MacBook工具</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="我的MacBook工具"><a href="#我的MacBook工具" class="headerlink" title="我的MacBook工具"></a>我的MacBook工具</h3><h4 id="Mac内置快捷键"><a href="#Mac内置快捷键" class="headerlink" title="Mac内置快捷键"></a>Mac内置快捷键</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">空格键: 预览</div><div class="line">cmd + ,: 设置</div><div class="line">cmd + -/=: 缩小/放大</div><div class="line">ctrl + u: 删除到行首(与zsh冲突, zsh中是删除整行)</div><div class="line">ctrl + k: 删除到行尾</div><div class="line">ctrl + p/n: 上/下移动一行或者前/后一个命令</div><div class="line">ctrl + b/f: 光标前/后移char</div><div class="line">esc + b/f: 光标前/后移word(蛋疼不能连续work)</div><div class="line">ctrl + a/e: 到行首/行尾</div><div class="line">ctrl + h/d: 删前/后字符</div><div class="line">ctrl + y: 粘贴</div><div class="line">ctrl + w: 删除前一个单词</div><div class="line">esc + d: 删后一个单词</div><div class="line">ctrl + _: undo</div><div class="line">ctrl + r: bck-i-search/reverse-i-search, 输入关键字搜索历史命令</div></pre></td></tr></table></figure>
<h4 id="WebSite类"><a href="#WebSite类" class="headerlink" title="WebSite类"></a>WebSite类</h4><ul>
<li>易集</li>
<li>百度云</li>
<li>百度脑图</li>
<li>七牛</li>
<li>微信公众号</li>
<li>DigitalOcean</li>
<li>Processon</li>
<li>GitHub</li>
<li>Toggl</li>
</ul>
<h4 id="开发环境类"><a href="#开发环境类" class="headerlink" title="开发环境类"></a>开发环境类</h4><ul>
<li>Homebrew</li>
<li>VisualVM</li>
<li>Jenkins</li>
<li>JDK</li>
<li>Redis</li>
<li>MySQL</li>
<li>Nginx</li>
<li>Tomcat</li>
<li>Maven</li>
</ul>
<h4 id="开发工具类"><a href="#开发工具类" class="headerlink" title="开发工具类"></a>开发工具类</h4><ul>
<li>Docker : <a href="https://www.docker.com" target="_blank" rel="external">https://www.docker.com</a></li>
<li>Postman : <a href="http://www.pc6.com/mac/224724.html" target="_blank" rel="external">http://www.pc6.com/mac/224724.html</a></li>
<li>Paw : <a href="http://www.pc6.com/mac/182304.html" target="_blank" rel="external">http://www.pc6.com/mac/182304.html</a></li>
<li>iTerm + zsh : <a href="http://www.iterm2.com" target="_blank" rel="external">http://www.iterm2.com</a></li>
<li>Charles : <a href="http://www.pc6.com/mac/137987.html" target="_blank" rel="external">http://www.pc6.com/mac/137987.html</a></li>
<li>Wireshark : <a href="https://www.wireshark.org/download.html" target="_blank" rel="external">https://www.wireshark.org/download.html</a></li>
<li>iHex : AppStore</li>
<li>Parallels Desktop 9 : <a href="http://www.pc6.com/mac/111671.html" target="_blank" rel="external">http://www.pc6.com/mac/111671.html</a></li>
<li>Parallels Desktop 11 : <a href="http://www.pc6.com/mac/119748.html" target="_blank" rel="external">http://www.pc6.com/mac/119748.html</a></li>
<li>JD-GUI : <a href="http://www.pc6.com/mac/152875.html" target="_blank" rel="external">http://www.pc6.com/mac/152875.html</a></li>
<li>PyCharm : <a href="https://www.jetbrains.com/pycharm/" target="_blank" rel="external">https://www.jetbrains.com/pycharm/</a></li>
<li>Gogland : <a href="https://www.jetbrains.com/go/" target="_blank" rel="external">https://www.jetbrains.com/go/</a></li>
<li>Idea : <a href="https://www.jetbrains.com/idea/" target="_blank" rel="external">https://www.jetbrains.com/idea/</a></li>
<li>Eclipse : <a href="https://www.eclipse.org/downloads/" target="_blank" rel="external">https://www.eclipse.org/downloads/</a></li>
<li>Navicat : <a href="http://www.pc6.com/mac/111878.html" target="_blank" rel="external">http://www.pc6.com/mac/111878.html</a></li>
<li>rdm : <a href="https://redisdesktop.com" target="_blank" rel="external">https://redisdesktop.com</a></li>
<li>Transmit : <a href="http://www.pc6.com/mac/111959.html" target="_blank" rel="external">http://www.pc6.com/mac/111959.html</a></li>
<li>SourceTree : <a href="https://www.sourcetreeapp.com" target="_blank" rel="external">https://www.sourcetreeapp.com</a></li>
<li>Gitbox : <a href="http://www.gitboxapp.com" target="_blank" rel="external">http://www.gitboxapp.com</a></li>
<li>Apidoc : <a href="https://github.com/apidoc/apidoc">https://github.com/apidoc/apidoc</a></li>
</ul>
<h4 id="文本编辑类"><a href="#文本编辑类" class="headerlink" title="文本编辑类"></a>文本编辑类</h4><ul>
<li>VSCode : <a href="https://code.visualstudio.com" target="_blank" rel="external">https://code.visualstudio.com</a></li>
<li>Sublime : <a href="http://www.sublimetext.com" target="_blank" rel="external">http://www.sublimetext.com</a></li>
<li>Atom : <a href="https://atom.io" target="_blank" rel="external">https://atom.io</a></li>
<li>Beyond Compare : <a href="http://www.pc6.com/mac/118063.html" target="_blank" rel="external">http://www.pc6.com/mac/118063.html</a></li>
<li>DiffMerge : <a href="http://www.pc6.com/mac/177700.html" target="_blank" rel="external">http://www.pc6.com/mac/177700.html</a></li>
<li>MacDown : <a href="http://www.pc6.com/mac/137960.html" target="_blank" rel="external">http://www.pc6.com/mac/137960.html</a></li>
<li>MWeb Lite : AppStore</li>
<li>Marboo : AppStore</li>
<li>为知笔记 : <a href="http://wiz.cn/" target="_blank" rel="external">http://wiz.cn/</a></li>
<li>印象笔记 : AppStore</li>
<li>有道笔记 : AppStore</li>
<li>Raindrop.io : AppStore</li>
</ul>
<h4 id="工作效率类"><a href="#工作效率类" class="headerlink" title="工作效率类"></a>工作效率类</h4><ul>
<li>Toggl : AppStore</li>
<li>GoodTask : <a href="http://www.pc6.com/mac/111678.html" target="_blank" rel="external">http://www.pc6.com/mac/111678.html</a></li>
<li>SizeUp : <a href="http://www.pc6.com/mac/113354.html" target="_blank" rel="external">http://www.pc6.com/mac/113354.html</a></li>
<li>Moom : <a href="http://www.pc6.com/mac/112487.html" target="_blank" rel="external">http://www.pc6.com/mac/112487.html</a></li>
<li>CheatSheet : <a href="http://www.pc6.com/mac/123173.html" target="_blank" rel="external">http://www.pc6.com/mac/123173.html</a></li>
<li>Shadowsocks : <a href="https://github.com/shadowsocks/shadowsocks-iOS/releases">https://github.com/shadowsocks/shadowsocks-iOS/releases</a></li>
<li>XtraFinder : <a href="http://www.pc6.com/mac/118547.html" target="_blank" rel="external">http://www.pc6.com/mac/118547.html</a></li>
<li>Dash : AppStore</li>
<li>Alfred : AppStore</li>
<li>Caffeine : <a href="http://www.pc6.com/mac/121734.html" target="_blank" rel="external">http://www.pc6.com/mac/121734.html</a></li>
<li>Hocus Focus : <a href="http://hocusfoc.us" target="_blank" rel="external">http://hocusfoc.us</a></li>
<li>Manico : AppStore</li>
<li>Symless : <a href="http://symless.com/nightly" target="_blank" rel="external">http://symless.com/nightly</a></li>
</ul>
<h4 id="休闲娱乐"><a href="#休闲娱乐" class="headerlink" title="休闲娱乐"></a>休闲娱乐</h4><ul>
<li>网易云音乐</li>
<li>QQ</li>
<li>微信</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac/">Mac</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Others/">Others</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Go/Go学习（六）Go对字符串的操作" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/10/Go/Go学习（六）Go对字符串的操作/" class="article-date">
  	<time datetime="2017-01-10T07:48:28.000Z" itemprop="datePublished">2017-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/10/Go/Go学习（六）Go对字符串的操作/">Go学习（六）Go对字符串的操作（转）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>之前项目中有个功能是获取当前月份第一天的日期的需求，也就是如果今天的日期是”20170110”，我需要获取到的日期是”20170101”。</p>
<ul>
<li>方式一：通过time获取当月的第一天</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//昨天的日期</div><div class="line">yesterdayTime := time.Now().AddDate(0, 0, -1)</div><div class="line">//上周的日期</div><div class="line">lastweekTime := time.Now().AddDate(0, 0, -8)</div></pre></td></tr></table></figure>
<p>缺点：无法确定今天与当月第一天间隔多少天，所以需要结合方式二一起使用</p>
<ul>
<li>方式二：通过time分别获取当前日期的年，月，日，然后重新拼接</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">year := time.Now().Year()</div><div class="line">month := time.Now().Month()</div><div class="line">day := time.Now().Day()</div></pre></td></tr></table></figure>
<p>缺点：month获取出来是英文January，而不是01</p>
<ul>
<li>方式三：将日期转换成字符串，然后截取字符串，删除字符串的最后两位字符加上”01”，或者是直接替换最后两位字符</li>
</ul>
<p>缺点：在Go官方strings包中并没有找到合适的截取或者替换方法，下面是转自别人总结的strings包的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"># 获取当前时间戳</div><div class="line">fmt.Println(time.Now().Unix())</div><div class="line"># 1389058332</div><div class="line"></div><div class="line"># 格式化当前时间</div><div class="line">fmt.Println(time.Now().Format(&quot;2006-01-02 15:04:05&quot;))</div><div class="line"># 2014-01-07 09:42:20</div><div class="line"></div><div class="line"># 时间戳转str格式化时间</div><div class="line">str_time := time.Unix(1389058332, 0).Format(&quot;2006-01-02 15:04:05&quot;)</div><div class="line">fmt.Println(str_time)</div><div class="line"># 2014-01-07 09:32:12</div><div class="line"></div><div class="line"># str格式化时间转时间戳</div><div class="line">the_time := time.Date(2014, 1, 7, 5, 50, 4, 0, time.Local)</div><div class="line">unix_time := the_time.Unix()</div><div class="line">fmt.Println(unix_time)</div><div class="line"># 389045004</div><div class="line"></div><div class="line"># 使用time.Parse将str格式化时间转时间戳</div><div class="line">the_time, err := time.Parse(&quot;2006-01-02 15:04:05&quot;, &quot;2014-01-08 09:04:41&quot;)</div><div class="line">if err == nil &#123;</div><div class="line">    unix_time := the_time.Unix()</div><div class="line">    fmt.Println(unix_time)		</div><div class="line">&#125;</div><div class="line"># 1389171881</div></pre></td></tr></table></figure>
<ul>
<li><a href="http://www.cnblogs.com/golove/p/3236300.html" target="_blank" rel="external">http://www.cnblogs.com/golove/p/3236300.html</a></li>
<li><a href="https://my.oschina.net/1123581321/blog/190942" target="_blank" rel="external">https://my.oschina.net/1123581321/blog/190942</a></li>
</ul>
<h3 id="strings包方法"><a href="#strings包方法" class="headerlink" title="strings包方法"></a>strings包方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line">// 转换</div><div class="line"></div><div class="line">func ToUpper(s string) string</div><div class="line">func ToLower(s string) string</div><div class="line">func ToTitle(s string) string</div><div class="line"></div><div class="line">func ToUpperSpecial(_case unicode.SpecialCase, s string) string</div><div class="line">func ToLowerSpecial(_case unicode.SpecialCase, s string) string</div><div class="line">func ToTitleSpecial(_case unicode.SpecialCase, s string) string</div><div class="line"></div><div class="line">func Title(s string) string</div><div class="line"></div><div class="line">------------------------------</div><div class="line"></div><div class="line">// 比较</div><div class="line">func Compare(a, b string) int</div><div class="line">func EqualFold(s, t string) bool</div><div class="line"></div><div class="line">------------------------------</div><div class="line"></div><div class="line">// 清理</div><div class="line"></div><div class="line">func Trim(s string, cutset string) string</div><div class="line">func TrimLeft(s string, cutset string) string</div><div class="line">func TrimRight(s string, cutset string) string</div><div class="line"></div><div class="line">func TrimFunc(s string, f func(rune) bool) string</div><div class="line">func TrimLeftFunc(s string, f func(rune) bool) string</div><div class="line">func TrimRightFunc(s string, f func(rune) bool) string</div><div class="line"></div><div class="line">func TrimSpace(s string) string</div><div class="line"></div><div class="line">func TrimPrefix(s, prefix string) string</div><div class="line">func TrimSuffix(s, suffix string) string</div><div class="line"></div><div class="line">------------------------------</div><div class="line"></div><div class="line">// 拆合</div><div class="line"></div><div class="line">func Split(s, sep string) []string</div><div class="line">func SplitN(s, sep string, n int) []string</div><div class="line"></div><div class="line">func SplitAfter(s, sep string) []string</div><div class="line">func SplitAfterN(s, sep string, n int) []string</div><div class="line"></div><div class="line">func Fields(s string) []string</div><div class="line">func FieldsFunc(s string, f func(rune) bool) []string</div><div class="line"></div><div class="line">func Join(a []string, sep string) string</div><div class="line"></div><div class="line">func Repeat(s string, count int) string</div><div class="line"></div><div class="line">------------------------------</div><div class="line"></div><div class="line">// 子串</div><div class="line"></div><div class="line">func HasPrefix(s, prefix string) bool</div><div class="line">func HasSuffix(s, suffix string) bool</div><div class="line"></div><div class="line">func Contains(s, substr string) bool</div><div class="line">func ContainsRune(s string, r rune) bool</div><div class="line">func ContainsAny(s, chars string) bool</div><div class="line"></div><div class="line">func Index(s, sep string) int</div><div class="line">func IndexByte(s string, c byte) int</div><div class="line">func IndexRune(s string, r rune) int</div><div class="line">func IndexAny(s, chars string) int</div><div class="line">func IndexFunc(s string, f func(rune) bool) int</div><div class="line"></div><div class="line">func LastIndex(s, sep string) int</div><div class="line">func LastIndexByte(s string, c byte) int</div><div class="line">func LastIndexAny(s, chars string) int</div><div class="line">func LastIndexFunc(s string, f func(rune) bool) int</div><div class="line"></div><div class="line">func Count(s, sep string) int</div><div class="line"></div><div class="line">------------------------------</div><div class="line"></div><div class="line">// 替换</div><div class="line"></div><div class="line">func Replace(s, old, new string, n int) string</div><div class="line"></div><div class="line">func Map(mapping func(rune) rune, s string) string</div><div class="line"></div><div class="line">------------------------------------------------------------</div><div class="line"></div><div class="line">type Reader struct &#123; ... &#125;</div><div class="line"></div><div class="line">func NewReader(s string) *Reader</div><div class="line"></div><div class="line">func (r *Reader) Read(b []byte) (n int, err error)</div><div class="line">func (r *Reader) ReadAt(b []byte, off int64) (n int, err error)</div><div class="line">func (r *Reader) WriteTo(w io.Writer) (n int64, err error)</div><div class="line">func (r *Reader) Seek(offset int64, whence int) (int64, error)</div><div class="line"></div><div class="line">func (r *Reader) ReadByte() (byte, error)</div><div class="line">func (r *Reader) UnreadByte() error</div><div class="line"></div><div class="line">func (r *Reader) ReadRune() (ch rune, size int, err error)</div><div class="line">func (r *Reader) UnreadRune() error</div><div class="line"></div><div class="line">func (r *Reader) Len() int</div><div class="line">func (r *Reader) Size() int64</div><div class="line">func (r *Reader) Reset(s string)</div><div class="line"></div><div class="line">------------------------------------------------------------</div><div class="line"></div><div class="line">type Replacer struct &#123; ... &#125;</div><div class="line"></div><div class="line">// 创建一个替换规则，参数为“查找内容”和“替换内容”的交替形式。</div><div class="line">// 替换操作会依次将第 1 个字符串替换为第 2 个字符串，将第 3 个字符串</div><div class="line">// 替换为第 4 个字符串，以此类推。</div><div class="line">// 替换规则可以同时被多个例程使用。</div><div class="line">func NewReplacer(oldnew ...string) *Replacer</div><div class="line"></div><div class="line">// 使用替换规则对 s 进行替换并返回结果。</div><div class="line">func (r *Replacer) Replace(s string) string</div><div class="line"></div><div class="line">// 使用替换规则对 s 进行替换并将结果写入 w。</div><div class="line">// 返回写入的字节数和遇到的错误。</div><div class="line">func (r *Replacer) WriteString(w io.Writer, s string) (n int, err error)</div></pre></td></tr></table></figure>
<p>上述的方式一和方式三都能实现此需求，但是方式三因为在strings包中没找到按照字符串索引位置截取的方法，所以在网上找到了一个自己实现的SubString截取字符串的方法。下面是具体的方法实现，更多字符串用法可以查看参考文章中的内容。</p>
<h3 id="字符串的截取"><a href="#字符串的截取" class="headerlink" title="字符串的截取"></a>字符串的截取</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">//截取字符串 start 起点下标 length 需要截取的长度</div><div class="line">func Substr(str string, start int, length int) string &#123;</div><div class="line">	rs := []rune(str)</div><div class="line">	rl := len(rs)</div><div class="line">	end := 0</div><div class="line"></div><div class="line">	if start &lt; 0 &#123;</div><div class="line">		start = rl - 1 + start</div><div class="line">	&#125;</div><div class="line">	end = start + length</div><div class="line"></div><div class="line">	if start &gt; end &#123;</div><div class="line">		start, end = end, start</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	if start &lt; 0 &#123;</div><div class="line">		start = 0</div><div class="line">	&#125;</div><div class="line">	if start &gt; rl &#123;</div><div class="line">		start = rl</div><div class="line">	&#125;</div><div class="line">	if end &lt; 0 &#123;</div><div class="line">		end = 0</div><div class="line">	&#125;</div><div class="line">	if end &gt; rl &#123;</div><div class="line">		end = rl</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	return string(rs[start:end])</div><div class="line">&#125;</div><div class="line"></div><div class="line">//截取字符串 start 起点下标 end 终点下标(不包括)</div><div class="line">func Substr2(str string, start int, end int) string &#123;</div><div class="line">	rs := []rune(str)</div><div class="line">	length := len(rs)</div><div class="line"></div><div class="line">	if start &lt; 0 || start &gt; length &#123;</div><div class="line">		panic(&quot;start is wrong&quot;)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	if end &lt; 0 || end &gt; length &#123;</div><div class="line">		panic(&quot;end is wrong&quot;)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	return string(rs[start:end])</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>参考文章：</p>
<ul>
<li><a href="http://studygolang.com/articles/4287" target="_blank" rel="external">http://studygolang.com/articles/4287</a></li>
<li><a href="http://www.cnblogs.com/golove/p/3236300.html" target="_blank" rel="external">http://www.cnblogs.com/golove/p/3236300.html</a></li>
<li><a href="http://blog.csdn.net/chenbaoke/article/details/40318423" target="_blank" rel="external">http://blog.csdn.net/chenbaoke/article/details/40318423</a></li>
<li><a href="https://my.oschina.net/manville/blog/313216" target="_blank" rel="external">https://my.oschina.net/manville/blog/313216</a></li>
<li><a href="http://studygolang.com/articles/5085" target="_blank" rel="external">http://studygolang.com/articles/5085</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/">Go</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Go/">Go</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Go/Go学习（五）Go的特殊语法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/10/Go/Go学习（五）Go的特殊语法/" class="article-date">
  	<time datetime="2017-01-10T07:44:56.000Z" itemprop="datePublished">2017-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/10/Go/Go学习（五）Go的特殊语法/">Go学习（五）Go的特殊语法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Go语言-和-有什么区别"><a href="#Go语言-和-有什么区别" class="headerlink" title="Go语言=和:=有什么区别"></a>Go语言=和:=有什么区别</h3><ul>
<li>= 符号的意思是给变量赋值，如果要使用必须先var声明</li>
<li>:= 符号的意思是声明并赋值，并且系统自动推断类型，不需要使用var声明</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// 使用var声明变量</div><div class="line">var a = 100</div><div class="line">var b int = 100</div><div class="line"></div><div class="line">// 如果var已经声明过这个变量了，想赋值给这个变量使用的是=，而不是:=</div><div class="line">var c</div><div class="line">c = 100</div><div class="line"></div><div class="line">// 声明并赋值</div><div class="line">d := 100</div></pre></td></tr></table></figure>
<h3 id="Go语言指针符号的-和-amp"><a href="#Go语言指针符号的-和-amp" class="headerlink" title="Go语言指针符号的*和&amp;"></a>Go语言指针符号的*和&amp;</h3><ul>
<li>&amp; 符号的意思是对变量取地址，如：变量a的地址是&amp;a</li>
<li><ul>
<li>符号的意思是对指针取值，如：*&amp;a，就是a变量所在地址的值，当然也就是a的值了</li>
</ul>
</li>
</ul>
<p>注意：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">* 和 &amp; 可以互相抵消，同时注意，*&amp; 可以抵消掉，但 &amp;* 是不可以抵消的</div><div class="line">a 和 *&amp;a 是一样的，都是a的值，值为1 (因为 *&amp; 互相抵消掉了)</div></pre></td></tr></table></figure>
<p>参考文章：</p>
<ul>
<li><a href="https://segmentfault.com/q/1010000007160096" target="_blank" rel="external">https://segmentfault.com/q/1010000007160096</a></li>
<li><a href="https://my.oschina.net/u/943306/blog/131269" target="_blank" rel="external">https://my.oschina.net/u/943306/blog/131269</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/">Go</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Go/">Go</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Go/Go学习（四）Go复合数据类型总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/10/Go/Go学习（四）Go复合数据类型总结/" class="article-date">
  	<time datetime="2017-01-10T06:02:41.000Z" itemprop="datePublished">2017-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/10/Go/Go学习（四）Go复合数据类型总结/">Go学习（四）Go复合数据类型总结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p>map是一种key-value的关系，一般都会使用make来初始化内存，有助于减少后续新增操作的内存分配次数。假如一开始定义了话，但没有用make来初始化，会报错的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line">import (</div><div class="line">    &quot;fmt&quot;</div><div class="line">)</div><div class="line"></div><div class="line">func main()&#123;</div><div class="line">    var test =  map[string]string&#123;&quot;姓名&quot;:&quot;李四&quot;,&quot;性别&quot;:&quot;男&quot;&#125;</div><div class="line">    name, ok := test[&quot;姓名&quot;]</div><div class="line">    // 假如key存在，则name = 李四，ok = true，否则，ok = false</div><div class="line">    if ok &#123;</div><div class="line">        fmt.Println(name)</div><div class="line">    &#125;</div><div class="line">    delete(test,&quot;姓名&quot;)//删除为姓名为key的值，不存在没关系</div><div class="line">    fmt.Println(test)</div><div class="line">    var a map[string]string</div><div class="line">    a[&quot;b&quot;] = &quot;c&quot;//这样会报错的，要先初始化内存</div><div class="line">    a = make(map[string]string)</div><div class="line">    a[&quot;b&quot;] = &quot;c&quot;//这样才不会错</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h3><p>接口的转换遵循以下规则：</p>
<ul>
<li>普通类型向接口类型的转换是隐式的。</li>
<li>接口类型向普通类型转换需要类型断言。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    &quot;fmt&quot;</div><div class="line">)</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">    var val interface&#123;&#125; = &quot;hello&quot;</div><div class="line">    fmt.Println(val)</div><div class="line">    val = []byte&#123;&apos;a&apos;, &apos;b&apos;, &apos;c&apos;&#125;</div><div class="line">    fmt.Println(val)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import &quot;fmt&quot;</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">	var i32 interface&#123;&#125;</div><div class="line">	i32 = int32(1)</div><div class="line">	</div><div class="line">	var i int</div><div class="line">	//i = i32.(int)  // won&apos;t work, you need to assert against the exact type in i32</div><div class="line">	</div><div class="line">	i32_tmp := i32.(int32) // this is called a type assertion</div><div class="line">	i = int(i32_tmp)</div><div class="line">	</div><div class="line">	fmt.Println(i)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>正如您所预料的，”hello”作为string类型存储在interface{}类型的变量val中，[]byte{‘a’, ‘b’, ‘c’}作为slice存储在interface{}类型的变量val中。这个过程是隐式的，是编译期确定的。</p>
<p>接口类型向普通类型转换有两种方式：Comma-ok断言和switch测试。任何实现了接口I的类型都可以赋值给这个接口类型变量。由于interface{}包含了0个方法，所以任何类型都实现了interface{}接口，这就是为什么可以将任意类型值赋值给interface{}类型的变量，包括nil。还有一个要注意的就是接口的实现问题，<em>T 包含了定义在 T 和 </em>T 上的所有方法，而T只包含定义在T上的方法。我们来看一个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    &quot;fmt&quot;</div><div class="line">)</div><div class="line"></div><div class="line">// 演讲者接口</div><div class="line">type Speaker interface &#123;</div><div class="line">    // 说</div><div class="line">    Say(string)</div><div class="line">    // 听</div><div class="line">    Listen(string) string</div><div class="line">    // 打断、插嘴</div><div class="line">    Interrupt(string)</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 王兰讲师</div><div class="line">type WangLan struct &#123;</div><div class="line">    msg string</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (this *WangLan) Say(msg string) &#123;</div><div class="line">    fmt.Printf(&quot;王兰说：%s\n&quot;, msg)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (this *WangLan) Listen(msg string) string &#123;</div><div class="line">    this.msg = msg</div><div class="line">    return msg</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (this *WangLan) Interrupt(msg string) &#123;</div><div class="line">    this.Say(msg)</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 江娄讲师</div><div class="line">type JiangLou struct &#123;</div><div class="line">    msg string</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (this *JiangLou) Say(msg string) &#123;</div><div class="line">    fmt.Printf(&quot;江娄说：%s\n&quot;, msg)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (this *JiangLou) Listen(msg string) string &#123;</div><div class="line">    this.msg = msg</div><div class="line">    return msg</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (this *JiangLou) Interrupt(msg string) &#123;</div><div class="line">    this.Say(msg)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">    wl := &amp;WangLan&#123;&#125;</div><div class="line">    jl := &amp;JiangLou&#123;&#125;</div><div class="line"></div><div class="line">    var person Speaker</div><div class="line">    person = wl</div><div class="line">    person.Say(&quot;Hello World!&quot;)</div><div class="line">    person = jl</div><div class="line">    person.Say(&quot;Good Luck!&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Speaker接口有两个实现WangLan类型和JiangLou类型。但是具体到实例来说，变量wl和变量jl只有是对应实例的指针类型才真正能被Speaker接口变量所持有。这是因为WangLan类型和JiangLou类型所有对Speaker接口的实现都是在*T上。这就是上例中person能够持有wl和jl的原因。</p>
<p>想象一下Java的泛型(很可惜golang不支持泛型)，java在支持泛型之前需要手动装箱和拆箱。由于golang能将不同的类型存入到接口类型的变量中，使得问题变得更加复杂。所以有时候我们不得不面临这样一个问题：我们究竟往接口存入的是什么样的类型？有没有办法反向查询？答案是肯定的。</p>
<p>Comma-ok断言的语法是：value, ok := element.(T)。element必须是接口类型的变量，T是普通类型。如果断言失败，ok为false，否则ok为true并且value为变量的值。来看个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    &quot;fmt&quot;</div><div class="line">)</div><div class="line"></div><div class="line">type Html []interface&#123;&#125;</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">    html := make(Html, 5)</div><div class="line">    html[0] = &quot;div&quot;</div><div class="line">    html[1] = &quot;span&quot;</div><div class="line">    html[2] = []byte(&quot;script&quot;)</div><div class="line">    html[3] = &quot;style&quot;</div><div class="line">    html[4] = &quot;head&quot;</div><div class="line">    for index, element := range html &#123;</div><div class="line">        if value, ok := element.(string); ok &#123;</div><div class="line">            fmt.Printf(&quot;html[%d] is a string and its value is %s\n&quot;, index, value)</div><div class="line">        &#125; else if value, ok := element.([]byte); ok &#123;</div><div class="line">            fmt.Printf(&quot;html[%d] is a []byte and its value is %s\n&quot;, index, string(value))</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实Comma-ok断言还支持另一种简化使用的方式：value := element.(T)。但这种方式不建议使用，因为一旦element.(T)断言失败，则会产生运行时错误。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    &quot;fmt&quot;</div><div class="line">)</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">    var val interface&#123;&#125; = &quot;good&quot;</div><div class="line">    fmt.Println(val.(string))</div><div class="line">    // fmt.Println(val.(int))</div><div class="line">&#125;</div><div class="line">以上的代码中被注释的那一行会运行时错误。这是因为val实际存储的是string类型，因此断言失败。</div><div class="line"></div><div class="line">还有一种转换方式是switch测试。既然称之为switch测试，也就是说这种转换方式只能出现在switch语句中。可以很轻松的将刚才用Comma-ok断言的例子换成由switch测试来实现：</div><div class="line"></div><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    &quot;fmt&quot;</div><div class="line">)</div><div class="line"></div><div class="line">type Html []interface&#123;&#125;</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">    html := make(Html, 5)</div><div class="line">    html[0] = &quot;div&quot;</div><div class="line">    html[1] = &quot;span&quot;</div><div class="line">    html[2] = []byte(&quot;script&quot;)</div><div class="line">    html[3] = &quot;style&quot;</div><div class="line">    html[4] = &quot;head&quot;</div><div class="line">    for index, element := range html &#123;</div><div class="line">        switch value := element.(type) &#123;</div><div class="line">        case string:</div><div class="line">            fmt.Printf(&quot;html[%d] is a string and its value is %s\n&quot;, index, value)</div><div class="line">        case []byte:</div><div class="line">            fmt.Printf(&quot;html[%d] is a []byte and its value is %s\n&quot;, index, string(value))</div><div class="line">        case int:</div><div class="line">            fmt.Printf(&quot;error type\n&quot;)</div><div class="line">        default:</div><div class="line">            fmt.Printf(&quot;unknown type\n&quot;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    &quot;fmt&quot;</div><div class="line">    &quot;reflect&quot;</div><div class="line">)</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">    var val interface&#123;&#125; = int64(58)</div><div class="line">    fmt.Println(reflect.TypeOf(val))</div><div class="line">    val = 50</div><div class="line">    fmt.Println(reflect.TypeOf(val))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们已经知道接口类型的变量底层是作为两个成员来实现，一个是type，一个是data。type用于存储变量的动态类型，data用于存储变量的具体数据。在上面的例子中，第一条打印语句输出的是：int64。这是因为已经显示的将类型为int64的数据58赋值给了interface类型的变量val，所以val的底层结构应该是：(int64, 58)。我们暂且用这种二元组的方式来描述，二元组的第一个成员为type，第二个成员为data。第二条打印语句输出的是：int。这是因为字面量的整数在golang中默认的类型是int，所以这个时候val的底层结构就变成了：(int, 50)。</p>
<p>理解上就是，感觉比静态的类型逼格高一点,总之我的interface就写在那里，你要是想继承我，使用我的方法,就把这些方法实现了就行，并不要求你显示的声明，继承自我，怎样怎样。有些动态类型的语言在运行期才能进行类型的语法检测，go语言在编译期间就可以检测。</p>
<p>参考文章：</p>
<ul>
<li><a href="http://blog.csdn.net/newjueqi/article/details/36388665" target="_blank" rel="external">http://blog.csdn.net/newjueqi/article/details/36388665</a></li>
<li><a href="http://blog.csdn.net/kjfcpua/article/details/18665041" target="_blank" rel="external">http://blog.csdn.net/kjfcpua/article/details/18665041</a></li>
<li><a href="http://blog.csdn.net/kjfcpua/article/details/18667255" target="_blank" rel="external">http://blog.csdn.net/kjfcpua/article/details/18667255</a></li>
<li><a href="https://play.golang.org/p/EVyMNehzbq" target="_blank" rel="external">https://play.golang.org/p/EVyMNehzbq</a></li>
</ul>
<p>编程规范</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000000464394" target="_blank" rel="external">https://segmentfault.com/a/1190000000464394</a></li>
<li><a href="http://studygolang.com/articles/2059" target="_blank" rel="external">http://studygolang.com/articles/2059</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/">Go</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Go/">Go</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Go/Go学习（三）Go基本数据类型总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/10/Go/Go学习（三）Go基本数据类型总结/" class="article-date">
  	<time datetime="2017-01-10T02:31:02.000Z" itemprop="datePublished">2017-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/10/Go/Go学习（三）Go基本数据类型总结/">Go学习（三）Go基本数据类型总结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近一直在写Go，但是一直都不是很明白Go的基础数据类型都有哪些，int，int32，int64都有，而且运算的时候还需要先转换，感觉使用起来很麻烦，所以特意看了一下官方文档深入了解一下Go相关的数据类型。</p>
<ul>
<li>基本类型：boolean，numeric，string类型的命名实例是预先声明的。</li>
<li>复合类型：array，struct，指针，function，interface，slice，map，channel类型（可以使用type构造）。</li>
</ul>
<h3 id="Numeric-types"><a href="#Numeric-types" class="headerlink" title="Numeric types"></a>Numeric types</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">A numeric type represents sets of integer or floating-point values. The predeclared architecture-independent numeric types are:</div><div class="line"></div><div class="line">uint8       the set of all unsigned  8-bit integers (0 to 255)</div><div class="line">uint16      the set of all unsigned 16-bit integers (0 to 65535)</div><div class="line">uint32      the set of all unsigned 32-bit integers (0 to 4294967295)</div><div class="line">uint64      the set of all unsigned 64-bit integers (0 to 18446744073709551615)</div><div class="line"></div><div class="line">int8        the set of all signed  8-bit integers (-128 to 127)</div><div class="line">int16       the set of all signed 16-bit integers (-32768 to 32767)</div><div class="line">int32       the set of all signed 32-bit integers (-2147483648 to 2147483647)</div><div class="line">int64       the set of all signed 64-bit integers (-9223372036854775808 to 9223372036854775807)</div><div class="line"></div><div class="line">float32     the set of all IEEE-754 32-bit floating-point numbers</div><div class="line">float64     the set of all IEEE-754 64-bit floating-point numbers</div><div class="line"></div><div class="line">complex64   the set of all complex numbers with float32 real and imaginary parts</div><div class="line">complex128  the set of all complex numbers with float64 real and imaginary parts</div><div class="line"></div><div class="line">byte        alias for uint8</div><div class="line">rune        alias for int32</div><div class="line"></div><div class="line">The value of an n-bit integer is n bits wide and represented using two&apos;s complement arithmetic.</div><div class="line"></div><div class="line">There is also a set of predeclared numeric types with implementation-specific sizes:</div><div class="line"></div><div class="line">uint     		either 32 or 64 bits</div><div class="line">int      		same size as uint</div><div class="line">uintptr  		an unsigned integer large enough to store the uninterpreted bits of a pointer value</div><div class="line"></div><div class="line">To avoid portability issues all numeric types are distinct except byte, which is an alias for uint8, and rune, which is an alias for int32. Conversions are required when different numeric types are mixed in an expression or assignment. </div><div class="line">For instance, int32 and int are not the same type even though they may have the same size on a particular architecture.</div></pre></td></tr></table></figure>
<ol>
<li><p>int类型中哪些支持负数</p>
<ul>
<li>有符号（负号）：int8 int16 int32 int64</li>
<li>无符号（负号）：uint8 uint16 uint32 uint64</li>
</ul>
</li>
<li><p>浮点类型的值有float32和float64(没有 float 类型)</p>
</li>
<li><p>byte和rune特殊类型是别名</p>
<ul>
<li>byte就是unit8的别名</li>
<li>rune就是int32的别名</li>
</ul>
</li>
<li><p>int和uint取决于操作系统（32位机器上就是32字节，64位机器上就是64字节）</p>
<ul>
<li>uint是32字节或者64字节</li>
<li>int和uint是一样的大小</li>
</ul>
</li>
<li><p>为了避免可移植性问题，除了byte（它是uint8的别名）和rune（它是int32的别名）之外，所有数字类型都是不同的。 在表达式或赋值中混合使用不同的数字类型时，需要转换。例如，int32和int不是相同的类型，即使它们可能在特定架构上具有相同的大小。</p>
</li>
</ol>
<p>所以上面的文档解释了为什么int，int32，int64之间需要进行类型转换才能进行运算。</p>
<h3 id="String-types"><a href="#String-types" class="headerlink" title="String types"></a>String types</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">A string type represents the set of string values. A string value is a (possibly empty) sequence of bytes. Strings are immutable: once created, it is impossible to change the contents of a string. The predeclared string type is string.</div><div class="line"></div><div class="line">The length of a string s (its size in bytes) can be discovered using the built-in function len. The length is a compile-time constant if the string is a constant. A string&apos;s bytes can be accessed by integer indices 0 through len(s)-1. It is illegal to take the address of such an element; if s[i] is the i&apos;th byte of a string, &amp;s[i] is invalid.</div></pre></td></tr></table></figure>
<p>字符串是不可变的：一旦创建，就不可能改变字符串的内容。 预先声明的字符串类型是字符串。</p>
<p>可以使用内置函数len来发现字符串s的长度（以字节为单位的大小）。 如果字符串是常量，则length是编译时常量。 字符串的字节可以通过整数索引0到len（s）-1来访问。 取这种元素的地址是非法的; 如果s [i]是字符串的第i个字节，则＆s [i]无效。</p>
<h3 id="Map-Types"><a href="#Map-Types" class="headerlink" title="Map Types"></a>Map Types</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">make(map[string]int)</div><div class="line">make(map[string]int, 100)</div><div class="line">The initial capacity does not bound its size: maps grow to accommodate the number of items stored in them, with the exception of nil maps. A nil map is equivalent to an empty map except that no elements may be added.</div></pre></td></tr></table></figure>
<p>初始容量不限制其大小：map增长以适应存储在其中的项目数，除了nil map。 nil map等价于空map，不能添加元素。</p>
<h3 id="int，int32，int64相互转换"><a href="#int，int32，int64相互转换" class="headerlink" title="int，int32，int64相互转换"></a>int，int32，int64相互转换</h3><h5 id="int转换成int32，int64"><a href="#int转换成int32，int64" class="headerlink" title="int转换成int32，int64"></a>int转换成int32，int64</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// int转换成int32</div><div class="line">i32 = int32(i)</div><div class="line"></div><div class="line">// int转换成int64</div><div class="line">i64 = int64(i)</div></pre></td></tr></table></figure>
<h5 id="int32，int64转换成int"><a href="#int32，int64转换成int" class="headerlink" title="int32，int64转换成int"></a>int32，int64转换成int</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// int32转换成int</div><div class="line">i = int(int32)</div><div class="line"></div><div class="line">// int64转换成int</div><div class="line">i = int(int64)</div></pre></td></tr></table></figure>
<h5 id="实例测试"><a href="#实例测试" class="headerlink" title="实例测试"></a>实例测试</h5><p>测试一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    &quot;fmt&quot;</div><div class="line">)</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">    // 超出int32范围的值</div><div class="line">    var i64 int64 = 2147483647123</div><div class="line">    var i32 int32</div><div class="line">    var i int</div><div class="line">    </div><div class="line">    // 转换不会损失精读（因为操作系统是64位，int就相当于int64）</div><div class="line">    i = int(i64)</div><div class="line">    // 转换会损失精读</div><div class="line">    i32 = int32(i64)</div><div class="line">    </div><div class="line">    fmt.Println(i)</div><div class="line">    fmt.Println(i32)</div><div class="line">    fmt.Println(i64)</div><div class="line">&#125;</div><div class="line"></div><div class="line">结果如下：</div><div class="line">2147483647123</div><div class="line">-877</div><div class="line">2147483647123</div></pre></td></tr></table></figure>
<p>测试二：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    &quot;fmt&quot;</div><div class="line">)</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">    var i64 int64</div><div class="line">    // 不超出int32范围的值</div><div class="line">    var i32 int32 = 21474836</div><div class="line">    var i int</div><div class="line">    </div><div class="line">    // 转换不会损失精读</div><div class="line">    i = int(i32)</div><div class="line">    // 转换不会损失精读</div><div class="line">    i64 = int64(i32)</div><div class="line">    </div><div class="line">    fmt.Println(i)</div><div class="line">    fmt.Println(i32)</div><div class="line">    fmt.Println(i64)</div><div class="line">&#125;</div><div class="line"></div><div class="line">结果如下：</div><div class="line">21474836</div><div class="line">21474836</div><div class="line">21474836</div></pre></td></tr></table></figure>
<h3 id="int和string相互转换"><a href="#int和string相互转换" class="headerlink" title="int和string相互转换"></a>int和string相互转换</h3><h5 id="int，int32，int64转换成string"><a href="#int，int32，int64转换成string" class="headerlink" title="int，int32，int64转换成string"></a>int，int32，int64转换成string</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 通过fmt.Sprintf方法转换（%d代表Integer，i可以是int，int32，int64类型）</div><div class="line">str1 := fmt.Sprintf(&quot;%d&quot;, i)</div><div class="line"></div><div class="line">// 通过strconv.Itoa方法转换（i是int类型）</div><div class="line">str2 := strconv.Itoa(i)</div><div class="line"></div><div class="line">// 通过strconv.FormatInt方法转换（i可以是int，int32，int64类型）</div><div class="line">str3 := strconv.FormatInt(int64(i), 10)</div></pre></td></tr></table></figure>
<ul>
<li>fmt.Sprintf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// Sprint formats using the default formats for its operands and returns the resulting string.</div><div class="line">// Spaces are added between operands when neither is a string.</div><div class="line">func Sprint(a ...interface&#123;&#125;) string &#123;</div><div class="line">    p := newPrinter()</div><div class="line">    p.doPrint(a)</div><div class="line">    s := string(p.buf)</div><div class="line">    p.free()</div><div class="line">    return s</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>strconv.Itoa实现</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">func Itoa(i int) string &#123;</div><div class="line">    return FormatInt(int64(i), 10)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>strconv.FormatInt实现</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// FormatInt returns the string representation of i in the given base,</div><div class="line">// for 2 &lt;= base &lt;= 36. The result uses the lower-case letters &apos;a&apos; to &apos;z&apos;</div><div class="line">// for digit values &gt;= 10.</div><div class="line">func FormatInt(i int64, base int) string &#123;</div><div class="line">    _, s := formatBits(nil, uint64(i), base, i &lt; 0, false)</div><div class="line">    return s</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="string转换成int，int32，int64"><a href="#string转换成int，int32，int64" class="headerlink" title="string转换成int，int32，int64"></a>string转换成int，int32，int64</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// string转换成int64</div><div class="line">strInt64, _ := strconv.ParseInt(str, 10, 64)</div><div class="line"></div><div class="line">// string转换成int32</div><div class="line">strInt32, _ := strconv.ParseInt(str, 10, 32)</div><div class="line">// 这里strInt32实际上还是int64类型的，只是截取了32位，所以最终还是要强转一下变成int32类型，如果不强转成int32是会编译报错的</div><div class="line">var realInt32 int32 = 0</div><div class="line">realInt32 := int32(strInt32)</div><div class="line"></div><div class="line">// string转换成int</div><div class="line">strInt, err := strconv.Atoi(str)</div></pre></td></tr></table></figure>
<p>参考文章：</p>
<ul>
<li><a href="https://my.oschina.net/goal/blog/196891" target="_blank" rel="external">https://my.oschina.net/goal/blog/196891</a></li>
<li><a href="https://golang.org/ref/spec#Numeric_types" target="_blank" rel="external">https://golang.org/ref/spec#Numeric_types</a></li>
<li><a href="http://stackoverflow.com/questions/39442167/convert-int32-to-string-in-golang" target="_blank" rel="external">http://stackoverflow.com/questions/39442167/convert-int32-to-string-in-golang</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/">Go</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Go/">Go</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Go/Go学习（二）引用第三方包" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/27/Go/Go学习（二）引用第三方包/" class="article-date">
  	<time datetime="2016-12-27T03:54:42.000Z" itemprop="datePublished">2016-12-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/27/Go/Go学习（二）引用第三方包/">Go学习（二）引用第三方包</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>上一篇开发环境搭建已经简单的引用了第三方glog包，这里我们回顾一下</p>
<h3 id="引用第三方包"><a href="#引用第三方包" class="headerlink" title="引用第三方包"></a>引用第三方包</h3><p>若你在包的导入路径中包含了代码仓库的URL，go get就会自动地获取、构建并安装它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ go get github.com/golang/glog</div></pre></td></tr></table></figure>
<p>若指定的包不在工作空间中，go get就会将会将它放到GOPATH指定的第一个工作空间内。（若该包已存在，go get就会跳过远程获取，其行为与go install相同）</p>
<p>在执行完上面的go get命令后，工作空间的目录树看起来应该是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">workspace_go</div><div class="line">     |</div><div class="line">     |--- TestGo</div><div class="line">     |      |</div><div class="line">     |      |--- src</div><div class="line">     |      |     |</div><div class="line">     |      |     |--- github.com</div><div class="line">     |      |     |      |</div><div class="line">     |      |     |      |--- golang</div><div class="line">     |      |     |             |</div><div class="line">     |      |     |             |--- glog</div><div class="line">     |      |     |                    |</div><div class="line">     |      |     |                    |--- LICENSE</div><div class="line">     |      |     |                    |</div><div class="line">     |      |     |                    |--- README</div><div class="line">     |      |     |                    |</div><div class="line">     |      |     |                    |--- glog.go</div><div class="line">     |      |     |                    |</div><div class="line">     |      |     |                    |--- glog_file.go</div><div class="line">     |      |     |                    |</div><div class="line">     |      |     |                    |--- glog_test.go</div><div class="line">     |      |     |</div><div class="line">     |      |     |--- hello</div><div class="line">     |      |     |      |</div><div class="line">     |      |     |      |--- hello.go</div><div class="line">     |      |     |</div><div class="line">     |      |     |--- main</div><div class="line">     |      |            |</div><div class="line">     |      |            |--- main.go</div><div class="line">     |      |</div><div class="line">     |      |--- bin</div><div class="line">     |      |     |</div><div class="line">     |      |     |--- main</div><div class="line">     |      |</div><div class="line">     |      |</div><div class="line">     |      |--- pkg</div><div class="line">     |            |</div><div class="line">     |            |--- github.com</div><div class="line">     |            |      |</div><div class="line">     |            |      |--- golang</div><div class="line">     |            |             |</div><div class="line">     |            |             |--- glog.a</div><div class="line">     |            |</div><div class="line">     |            |--- hello.a</div><div class="line">     |</div><div class="line">     |-- GoDemo</div></pre></td></tr></table></figure>
<p>hello.go</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">package hello</div><div class="line"></div><div class="line">import &quot;fmt&quot;</div><div class="line">import &quot;flag&quot;</div><div class="line">import &quot;github.com/golang/glog&quot;</div><div class="line"></div><div class="line">func Hello() &#123;</div><div class="line">    flag.Parse()</div><div class="line">    fmt.Println(&quot;Hello World!&quot;)</div><div class="line">    glog.Info(&quot;glog Hello World!&quot;)</div><div class="line">    glog.Flush()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意事项:  </p>
<ol>
<li>因为是使用时依参数配置，所以需在main()中加上flag.Parse()</li>
<li>需在结尾加上glog.Flush()</li>
<li>依级别生成不同的日志文件，但级别高的日志信息会同时在级别低的日志文件中输出</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ go run main.go -log_dir=./</div><div class="line">Hello World!</div><div class="line">$ ll</div><div class="line">lrwxr-xr-x  1 yunyu  staff   51 12 27 11:44 main.INFO -&gt; main.localhost.yunyu.log.INFO.20161227-114425.19830</div><div class="line">-rw-r--r--  1 yunyu  staff   72 12 22 14:39 main.go</div><div class="line">-rw-r--r--  1 yunyu  staff  186 12 27 11:44 main.localhost.yunyu.log.INFO.20161227-114425.19830</div><div class="line"></div><div class="line">$ vi main.INFO</div><div class="line">Log file created at: 2016/12/27 11:48:08</div><div class="line">Running on machine: localhost</div><div class="line">Binary: Built with gc go1.7.3 for darwin/amd64</div><div class="line">Log line format: [IWEF]mmdd hh:mm:ss.uuuuuu threadid file:line] msg</div><div class="line">I1227 11:48:08.088596   19951 hello.go:10] glog Hello World!</div></pre></td></tr></table></figure>
<h3 id="import用法"><a href="#import用法" class="headerlink" title="import用法"></a>import用法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import(</div><div class="line">    &quot;fmt&quot;</div><div class="line">)</div></pre></td></tr></table></figure>
<p>上面这个fmt是Go语言的标准库，他其实是去GOROOT下去加载该模块（先找GOROOT，如果GOROOT找不到在去GOPATH找），当然Go的import还支持如下两种方式来加载自己写的模块：</p>
<h4 id="相对路径"><a href="#相对路径" class="headerlink" title="相对路径"></a>相对路径</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import &quot;./model&quot;</div></pre></td></tr></table></figure>
<p>当前文件同一目录的model目录，但是不建议这种方式来import</p>
<h4 id="绝对路径"><a href="#绝对路径" class="headerlink" title="绝对路径"></a>绝对路径</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import &quot;shorturl/model&quot;</div></pre></td></tr></table></figure>
<p>加载gopath/src/shorturl/model模块</p>
<h4 id="点操作"><a href="#点操作" class="headerlink" title="点操作"></a>点操作</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import( . &quot;fmt&quot; )</div></pre></td></tr></table></figure>
<p>这个点操作的含义就是这个包导入之后在你调用这个包的函数时，你可以省略前缀的包名，<br>也就是前面你调用的fmt.Println(“hello world”)可以省略的写成Println(“hello world”)</p>
<h4 id="别名操作"><a href="#别名操作" class="headerlink" title="别名操作"></a>别名操作</h4><p>别名操作顾名思义我们可以把包命名成另一个我们用起来容易记忆的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import( f &quot;fmt&quot; )</div></pre></td></tr></table></figure>
<p>别名操作的话调用包函数时前缀变成了我们的前缀，即f.Println(“hello world”)</p>
<h4 id="操作"><a href="#操作" class="headerlink" title="_操作"></a>_操作</h4><p>这个操作经常是让很多人费解的一个操作符，请看下面这个import</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import ( &quot;database/sql&quot; _ &quot;github.com/ziutek/mymysql/godrv&quot; )</div></pre></td></tr></table></figure>
<p>_操作其实是引入该包，而不直接使用包里面的函数，而是调用了该包里面的init函数。</p>
<p>要理解这个问题，需要看下面这个图，理解包是怎么按照顺序加载的：</p>
<p>程序的初始化和执行都起始于main包。如果main包还导入了其它的包，那么就会在编译时将它们依次导入。有时一个包会被多个包同时导入，那么它只会被导入一次（例如很多包可能都会用到fmt包，但它只会被导入一次，因为没有必要导入多次）。当一个包被导入时，如果该包还导入了其它的包，那么会先将其它包导入进来，然后再对这些包中的包级常量和变量进行初始化，接着执行init函数（如果有的话），依次类推。等所有被导入的包都加载完毕了，就会开始对main包中的包级常量和变量进行初始化，然后执行main包中的init函数（如果存在的话），最后执行main函数。下图详细地解释了整个执行过程：</p>
<p><img src="http://static.open-open.com/lib/uploadImg/20131113/20131113222223_265.png" alt=""></p>
<p>通过上面的介绍我们了解了import的时候其实是执行了该包里面的init函数，初始化了里面的变量，_操作只是说该包引入了，我只初始化里面的 init函数和一些变量，但是往往这些init函数里面是注册自己包里面的引擎，让外部可以方便的使用，就很多实现database/sql的引起，在 init函数里面都是调用了sql.Register(name string, driver driver.Driver)注册自己，然后外部就可以使用了。</p>
<p>示例目录结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">GOPATH</div><div class="line">  |</div><div class="line">  |--bin</div><div class="line">  |</div><div class="line">  |--pkg</div><div class="line">  |</div><div class="line">  |--src</div><div class="line">      |</div><div class="line">      |--main.go</div><div class="line">      |</div><div class="line">      |--hello</div><div class="line">           |</div><div class="line">           |--init.go</div></pre></td></tr></table></figure>
<p>main.go</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import _ &quot;hello&quot;</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">    // hello.Print() 编译报错，说：undefined: hello</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>init.go</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">package hello</div><div class="line"></div><div class="line">import &quot;fmt&quot;</div><div class="line"></div><div class="line">func init() &#123;</div><div class="line">    fmt.Println(&quot;hello-init() come here.&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func Print() &#123;</div><div class="line">    fmt.Println(&quot;Hello!&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出结果：hello-init() come here.</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="命令安装第三方包"><a href="#命令安装第三方包" class="headerlink" title="命令安装第三方包"></a>命令安装第三方包</h4><p>安装第三方包命令，这条命令它会把第三方包源代码，下载解压到你的GOPATH路径里面去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go get github.com/golang/glog</div></pre></td></tr></table></figure>
<p>注意：首先必须设置环境变量GOPATH的路径，而且要安装了git客户端，否则go get命令不起作用</p>
<p>在代码中导入下载的那个第三方包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import (</div><div class="line">    &quot;github.com/golang/glog&quot;</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="手动安装第三方包"><a href="#手动安装第三方包" class="headerlink" title="手动安装第三方包"></a>手动安装第三方包</h4><p>如果是手动下载压缩包，就解压到$GOPATH/src里面的路径，然后执行go install github.com/golang/glog安装这个包。</p>
<p>参考文章：</p>
<ul>
<li><a href="http://www.cnblogs.com/wangqishu/p/5147108.html" target="_blank" rel="external">http://www.cnblogs.com/wangqishu/p/5147108.html</a></li>
<li><a href="http://www.open-open.com/lib/view/open1384352577352.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1384352577352.html</a></li>
<li><a href="http://studygolang.com/articles/4356" target="_blank" rel="external">http://studygolang.com/articles/4356</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/">Go</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Go/">Go</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Kafka/Kafka学习（六）Kafka集群的迁移与扩容" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/27/Kafka/Kafka学习（六）Kafka集群的迁移与扩容/" class="article-date">
  	<time datetime="2016-12-26T17:02:11.000Z" itemprop="datePublished">2016-12-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/27/Kafka/Kafka学习（六）Kafka集群的迁移与扩容/">Kafka学习（六）Kafka集群的迁移与扩容</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Kafka的集群扩容实际上就是把Topic的Partition移动到新加的集群节点上。我们只需要copy一份Kafka的安装目录到新的节点机器上，修改一下相关配置文件（broker.id，logs.dir等等），但是新添加的Kafka节点机器是不会自动分配数据的，所以需要我们手动操作。</p>
<p>Kafka的扩容可以细分为以下三种：</p>
<ul>
<li>增加节点</li>
<li>增加Topic副本</li>
<li>增加分区</li>
</ul>
<p>具体的步骤有两种方式:</p>
<ul>
<li>通过–topics-to-move-json-file和–broker-list批量生成新的Topic分区信息，然后根据该信息执行转移操作。</li>
<li>手动写要移动的topic信息，更灵活，但是在大量Topic和Partition的情况下非常繁琐并且容易出错。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">kafka-reassign-partitions.sh命令的三种模式</div><div class="line"></div><div class="line">generate模式：给需要重新分配的Topic，自动生成reassign plan（执行计划），但并不执行</div><div class="line">execute模式：根据指定的reassign plan（json文件）重新分配partition或者replication</div><div class="line">verify模式：检查重新分配是否完成</div><div class="line"></div><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --topics-to-move-json-file json_file --broker-list &quot;brokerIds&quot; --generate</div><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file json_file --execute</div><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file json_file --verify</div></pre></td></tr></table></figure>
<h3 id="Kafka动态增加节点（Node）"><a href="#Kafka动态增加节点（Node）" class="headerlink" title="Kafka动态增加节点（Node）"></a>Kafka动态增加节点（Node）</h3><p>新添加的Kafka节点机器是不会自动分配数据的，所以无法分担集群的负载，除非我们新建一个Topic，此时新的Topic会使用新添加的Kafka节点机器。如果我们想新添加的Kafka节点机器能够分担集群存储，需要手动将部分分区移动到新添加的Kafka节点机器上。</p>
<p>我们原来的Kafka节点分别是0，1，2，现在要加入3，4两个新节点</p>
<p>topicMove.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;topics&quot;:[</div><div class="line">        &#123;&quot;topic&quot;:&quot;logstash_test&quot;&#125;</div><div class="line">    ],</div><div class="line">    &quot;version&quot;:1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>生成迁移的计划</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --topics-to-move-json-file topicMove.json --broker-list &quot;0,1,2,3,4&quot; --generate</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[1,2,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[2,1,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[1,2,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,2,1]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:5,&quot;replicas&quot;:[0,1,2]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[2,0,1]&#125;]&#125;</div><div class="line">Proposed partition reassignment configuration</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[2,0,1]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,3,4]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[4,2,3]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,4,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:5,&quot;replicas&quot;:[4,3,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[3,1,2]&#125;]&#125;</div></pre></td></tr></table></figure>
<p>上面是原来的所有partition在各个节点的分布情况，下面是加入4，5两个新节点之后所有partition在各个节点的分布情况</p>
<p>将生成的执行计划保存为add_node.json文件</p>
<p>重新分配partition（其实这里是添加新的节点）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_node.json --execute</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[1,2,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[2,1,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[1,2,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,2,1]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:5,&quot;replicas&quot;:[0,1,2]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[2,0,1]&#125;]&#125;</div><div class="line"></div><div class="line">Save this to use as the --reassignment-json-file option during rollback</div><div class="line">Successfully started reassignment of partitions &#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[4,2,3]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[3,1,2]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:5,&quot;replicas&quot;:[4,3,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,4,0]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[2,0,1]&#125;,&#123;&quot;topic&quot;:&quot;logstash_test&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,3,4]&#125;]&#125;</div></pre></td></tr></table></figure>
<p>查看执行的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_node.json --verify</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR: Assigned replicas (X,X) don&apos;t match the list of replicas for reassignment (X,X) for partition [logstash_test,1]</div></pre></td></tr></table></figure>
<p>假设出现类似这样的错误，他并不是真的出错，而是指目前仍在复制数据中。再过一段时间再运行verify命令，他就会消失(加入完成拷贝)</p>
<p>当然也可以不使用generate先生成执行计划，而是自己直接手动编辑生成add_node.json文件内容，然后直接execute执行，但是这样容易出错，Kafka节点比较少的时候推荐使用。</p>
<p>注意：其实通过generate的结果我们也可以看出，其实不管是扩容，减容，迁移，其实都是重新分配Topic或者Partition的过程。json文件的内容都是指定Topic下的Partition要移动到哪个Node上。</p>
<h3 id="Kafka动态增加Topic副本（Replication）"><a href="#Kafka动态增加Topic副本（Replication）" class="headerlink" title="Kafka动态增加Topic副本（Replication）"></a>Kafka动态增加Topic副本（Replication）</h3><p>查看当前node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:1	ReplicationFactor:1	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 2	Replicas: 2	Isr: 2</div></pre></td></tr></table></figure>
<p>add_replication.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;version&quot;:1</div><div class="line">    &quot;partitions&quot;:[</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:0,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>重新分配partition（其实这里是添加副本replication）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_replication.json --execute</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[2]&#125;]&#125;</div><div class="line"></div><div class="line">Save this to use as the --reassignment-json-file option during rollback</div><div class="line">Successfully started reassignment of partitions &#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1,2]&#125;]&#125;</div></pre></td></tr></table></figure>
<p>查看执行的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_replication.json --verify</div><div class="line">Status of partition reassignment:</div><div class="line">Reassignment of partition [node_log,0] completed successfully</div></pre></td></tr></table></figure>
<p>如果遇到下面的错误很有可能是json文件格式有错误，仔细检查修正重新运行即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Partitions reassignment failed due to Partition reassignment data file add_replication.json is empty</div><div class="line">kafka.common.AdminCommandFailedException: Partition reassignment data file add_replication.json is empty</div><div class="line">	at kafka.admin.ReassignPartitionsCommand$.executeAssignment(ReassignPartitionsCommand.scala:120)</div><div class="line">	at kafka.admin.ReassignPartitionsCommand$.main(ReassignPartitionsCommand.scala:52)</div><div class="line">	at kafka.admin.ReassignPartitionsCommand.main(ReassignPartitionsCommand.scala)</div></pre></td></tr></table></figure>
<p>查看添加replication后的node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:1	ReplicationFactor:2	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 1,0,2</div></pre></td></tr></table></figure>
<h3 id="Kafka动态增加分区（Parition）"><a href="#Kafka动态增加分区（Parition）" class="headerlink" title="Kafka动态增加分区（Parition）"></a>Kafka动态增加分区（Parition）</h3><p>查看当前node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:1	ReplicationFactor:2	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 1,0,2</div></pre></td></tr></table></figure>
<p>add_partition.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;version&quot;:1,</div><div class="line">    &quot;partitions&quot;:[</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:0,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:1,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:2,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>重新分配partition</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_partition.json --execute</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1,2]&#125;]&#125;</div><div class="line"></div><div class="line">Save this to use as the --reassignment-json-file option during rollback</div><div class="line">[2016-12-30 12:22:17,195] ERROR Skipping reassignment of partition [node_log,1] since it doesn&apos;t exist (kafka.admin.ReassignPartitionsCommand)</div><div class="line">[2016-12-30 12:22:17,207] ERROR Skipping reassignment of partition [node_log,2] since it doesn&apos;t exist (kafka.admin.ReassignPartitionsCommand)</div><div class="line">Successfully started reassignment of partitions &#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1,2]&#125;,&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,1,2]&#125;,&#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,1,2]&#125;]&#125;</div></pre></td></tr></table></figure>
<p>查看执行的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_partition.json --verify</div><div class="line">Status of partition reassignment:</div><div class="line">ERROR: Assigned replicas (1,2,0) don&apos;t match the list of replicas for reassignment (0,1,2) for partition [node_log,1]</div><div class="line">ERROR: Assigned replicas (2,0,1) don&apos;t match the list of replicas for reassignment (0,1,2) for partition [node_log,2]</div><div class="line">Reassignment of partition [node_log,0] completed successfully</div><div class="line">Reassignment of partition [node_log,1] failed</div><div class="line">Reassignment of partition [node_log,2] failed</div></pre></td></tr></table></figure>
<p>报错是因为我们只有一个partition0，没有partition1，partition2，所以跳过了重新分配partition的过程。</p>
<p>我们需要先增加partition的数量，我们把partition的数量变成6个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --zookeeper localhost:2181 --alter --topic node_log --partitions 6</div><div class="line">WARNING: If partitions are increased for a topic that has a key, the partition logic or ordering of the messages will be affected</div><div class="line">Adding partitions succeeded!</div></pre></td></tr></table></figure>
<p>查看添加partition后的node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:6	ReplicationFactor:3	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 1,0,2</div><div class="line">	Topic: node_log	Partition: 1	Leader: 1	Replicas: 1,2,0	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 2	Leader: 2	Replicas: 2,0,1	Isr: 2,0,1</div><div class="line">	Topic: node_log	Partition: 3	Leader: 0	Replicas: 0,2,1	Isr: 0,2,1</div><div class="line">	Topic: node_log	Partition: 4	Leader: 1	Replicas: 1,0,2	Isr: 1,0,2</div><div class="line">	Topic: node_log	Partition: 5	Leader: 2	Replicas: 2,1,0	Isr: 2,1,0</div></pre></td></tr></table></figure>
<p>重新执行reassign，然后查看执行状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file ~/Downloads/add_partition.json --verify</div><div class="line">Status of partition reassignment:</div><div class="line">Reassignment of partition [node_log,0] completed successfully</div><div class="line">Reassignment of partition [node_log,1] completed successfully</div><div class="line">Reassignment of partition [node_log,2] completed successfully</div></pre></td></tr></table></figure>
<p>重新分配执行完成之后，再次查看node_log的Topic信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line"></div><div class="line">Topic:node_log	PartitionCount:6	ReplicationFactor:3	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 1	Leader: 0	Replicas: 0,1,2	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 2	Leader: 0	Replicas: 0,1,2	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 3	Leader: 0	Replicas: 0,2,1	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 4	Leader: 1	Replicas: 1,0,2	Isr: 1,2,0</div><div class="line">	Topic: node_log	Partition: 5	Leader: 2	Replicas: 2,1,0	Isr: 1,2,0</div></pre></td></tr></table></figure>
<p>执行reassign之后，我们发现0-3的partition的leader都是0，这是因为我们之前突然扩展partition到6个，而我们在reassign的之后只指定了0-2的partition的分配，我们修改一下add_partition.json文件如下，将6个partition均匀的分布在我们3个broker节点上，每个partition有2个replication。</p>
<p>add_partition.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;version&quot;:1,</div><div class="line">    &quot;partitions&quot;:[</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:0,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:1,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:2,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                2,</div><div class="line">                0</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:3,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                0,</div><div class="line">                1</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:4,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                1,</div><div class="line">                2</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;topic&quot;:&quot;node_log&quot;,</div><div class="line">            &quot;partition&quot;:5,</div><div class="line">            &quot;replicas&quot;:[</div><div class="line">                2,</div><div class="line">                0</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再次查看reassign之后的Topic情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:6	ReplicationFactor:2	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1	Isr: 0,1</div><div class="line">	Topic: node_log	Partition: 1	Leader: 1	Replicas: 1,2	Isr: 1,2</div><div class="line">	Topic: node_log	Partition: 2	Leader: 0	Replicas: 2,0	Isr: 0,2</div><div class="line">	Topic: node_log	Partition: 3	Leader: 0	Replicas: 0,1	Isr: 0,1</div><div class="line">	Topic: node_log	Partition: 4	Leader: 1	Replicas: 1,2	Isr: 1,2</div><div class="line">	Topic: node_log	Partition: 5	Leader: 2	Replicas: 2,0	Isr: 0,2</div></pre></td></tr></table></figure>
<p>我们发现还是有点小问题，partition2的leader仍然是0。这里先普及一下assigned replicas和preferred replica</p>
<h4 id="assigned-replicas和preferred-replica"><a href="#assigned-replicas和preferred-replica" class="headerlink" title="assigned replicas和preferred replica"></a>assigned replicas和preferred replica</h4><p>每个partitiion的所有replicas叫做”assigned replicas”，”assigned replicas”中的第一个replicas叫”preferred replica”，刚创建的topic一般”preferred replica”是leader。leader replica负责所有的读写。但随着时间推移，broker可能会停机，会导致leader迁移，导致机群的负载不均衡。</p>
<p>我们这里preferred replica已经是2了，但是leader却不是2，这样我们需要重新选举一下leader，需要使用kafka-preferred-replica-election.sh来调整。</p>
<p>两种操作方式：</p>
<ul>
<li>对所有Topics进行操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ kafka-preferred-replica-election.sh --zookeeper localhost:2181</div></pre></td></tr></table></figure>
<ul>
<li>对某个Topic进行操作（json文件中指定要操作的Topic）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ kafka-preferred-replica-election.sh --zookeeper localhost:2181 --path-to-json-file json_file</div></pre></td></tr></table></figure>
<p>注意：这里我们只需要调整node_log的Topic的partition2的leader。</p>
<p>leaderTopic.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"> &quot;partitions&quot;:</div><div class="line">  [</div><div class="line">    &#123;&quot;topic&quot;:&quot;node_log&quot;,&quot;partition&quot;:2&#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>重新选举leader</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ kafka-preferred-replica-election.sh --zookeeper localhost:2181 --path-to-json-file leaderTopic.json</div><div class="line">Successfully started preferred replica election for partitions Set([node_log,2])</div></pre></td></tr></table></figure>
<p>再次查看Topic情况，发现leader也是我们所期望的均匀分配了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log</div><div class="line">Topic:node_log	PartitionCount:6	ReplicationFactor:2	Configs:</div><div class="line">	Topic: node_log	Partition: 0	Leader: 0	Replicas: 0,1	Isr: 0,1</div><div class="line">	Topic: node_log	Partition: 1	Leader: 1	Replicas: 1,2	Isr: 2,1</div><div class="line">	Topic: node_log	Partition: 2	Leader: 2	Replicas: 2,0	Isr: 2,0</div><div class="line">	Topic: node_log	Partition: 3	Leader: 0	Replicas: 0,1	Isr: 0,1</div><div class="line">	Topic: node_log	Partition: 4	Leader: 1	Replicas: 1,2	Isr: 2,1</div><div class="line">	Topic: node_log	Partition: 5	Leader: 2	Replicas: 2,0	Isr: 0,2</div></pre></td></tr></table></figure>
<p>数据迁移的步骤</p>
<ol>
<li><p>The tool updates the zookeeper path “/admin/reassign_partitions” with the list of topic partitions and (if specified in the Json file) the list of their new assigned replicas.</p>
</li>
<li><p>The controller listens to the path above. When a data change update is triggered, the controller reads the list of topic partitions and their assigned replicas from zookeeper.</p>
</li>
<li><p>For each topic partition, the controller does the following:</p>
</li>
</ol>
<ul>
<li>3.1. Start new replicas in RAR – AR (RAR = Reassigned Replicas, AR = original list of Assigned Replicas)</li>
<li>3.2. Wait until new replicas are in sync with the leader</li>
<li>3.3. If the leader is not in RAR, elect a new leader from RAR</li>
<li>3.4. Stop old replicas AR – RAR</li>
<li>3.5. Write new AR</li>
<li>3.6. Remove partition from the /admin/reassign_partitions path</li>
</ul>
<p>参考文章：</p>
<ul>
<li><a href="http://blog.csdn.net/lsshlsw/article/details/47615747" target="_blank" rel="external">http://blog.csdn.net/lsshlsw/article/details/47615747</a></li>
<li><a href="https://www.iteblog.com/archives/1611" target="_blank" rel="external">https://www.iteblog.com/archives/1611</a></li>
<li><a href="https://www.iteblog.com/archives/1613" target="_blank" rel="external">https://www.iteblog.com/archives/1613</a></li>
<li><a href="https://www.iteblog.com/archives/1614" target="_blank" rel="external">https://www.iteblog.com/archives/1614</a></li>
<li><a href="http://wzktravel.github.io/2015/12/31/kafka-reassign/" target="_blank" rel="external">http://wzktravel.github.io/2015/12/31/kafka-reassign/</a></li>
<li><a href="http://blog.csdn.net/lizhitao/article/details/41441513" target="_blank" rel="external">http://blog.csdn.net/lizhitao/article/details/41441513</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/KAFKA/Replication+tools#Replicationtools-2.PreferredReplicaLeaderElectionTool" target="_blank" rel="external">https://cwiki.apache.org/confluence/display/KAFKA/Replication+tools#Replicationtools-2.PreferredReplicaLeaderElectionTool</a></li>
<li><a href="https://cwiki.apache.org/confluence/pages/diffpages.action?pageId=31819985&amp;originalId=34022604" target="_blank" rel="external">https://cwiki.apache.org/confluence/pages/diffpages.action?pageId=31819985&amp;originalId=34022604</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kafka/">Kafka</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/MQ/">MQ</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Kafka/Kafka学习（五）Kafka数据目录的迁移与扩容" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/26/Kafka/Kafka学习（五）Kafka数据目录的迁移与扩容/" class="article-date">
  	<time datetime="2016-12-26T08:40:47.000Z" itemprop="datePublished">2016-12-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/26/Kafka/Kafka学习（五）Kafka数据目录的迁移与扩容/">Kafka学习（五）Kafka数据目录的迁移与扩容</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>之前我们只有一个40G的磁盘挂在到/data0目录，Kafka的数据目录和日志目录都是写在/data0这个磁盘上的。但是很快收集上来的日志就将40G的磁盘写满了，然后我们又为Kafka集群的机器加了200G的磁盘，当时的200G磁盘是分成了2个100G的分别挂在到/data1和/data2目录上，我们也将原来40G的/data0目录下的数据全部都移动到/data1目录下，然后修改Kakfa的log.dirs配置，指定了多个Kafka数据存储目录。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">log.dirs=/data1/kafka_data,/data2/kafka_data</div></pre></td></tr></table></figure>
<p>重启Kafka集群之后一切都运行正常，但是/data2目录中却没有Topic的数据，当时也觉得有些奇怪，觉得可能是因为/data1磁盘没有写满就不会写入到/data2磁盘上，而且短时间内Kafka数据应该不会增长这么快，就没有深入研究。</p>
<p>悲剧来了，圣诞节放假期间公司线上Kafka集群突然磁盘占用已满，后来发现是日志量突然暴增，把Kafka磁盘写满了。SSH到线上Kafka服务器发现/data1磁盘已经写满了，但是仍然没有写入到/data2磁盘，说明我之前的猜想是错的（/data1写满了才会写入到/data2）。</p>
<p>开始以为是log.dirs配置没有生效，我又尝试在自己本机的Kafka集群尝试了修改配置，发现配置生效了，但是和线上服务器有些不同的是，在我本机的Kafka集群指定的/data2目录下是有文件的，也有Topic数据的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ ll /data/kafka_data1total 28drwxrwxr-x  4 yunyu yunyu 4096 Dec 26 16:57 ./drwxr-xr-x 17 yunyu yunyu 4096 Dec 24 23:39 ../drwxrwxr-x  2 yunyu yunyu 4096 Dec 24 23:56 go_log-0/drwxrwxr-x  2 yunyu yunyu 4096 Dec 24 23:56 golog-0/-rw-rw-r--  1 yunyu yunyu    0 Dec 24 23:56 .lock-rw-rw-r--  1 yunyu yunyu   54 Dec 24 23:56 meta.properties-rw-rw-r--  1 yunyu yunyu   25 Dec 26 16:57 recovery-point-offset-checkpoint-rw-rw-r--  1 yunyu yunyu   25 Dec 26 16:57 replication-offset-checkpoint</div><div class="line"></div><div class="line"></div><div class="line">$ ll /data/kafka_data2total 24drwxrwxr-x  3 yunyu yunyu 4096 Dec 26 16:57 ./drwxr-xr-x 17 yunyu yunyu 4096 Dec 24 23:39 ../-rw-rw-r--  1 yunyu yunyu    0 Dec 24 23:56 .lockdrwxrwxr-x  2 yunyu yunyu 4096 Dec 24 23:56 logstash_test-0/-rw-rw-r--  1 yunyu yunyu   54 Dec 24 23:56 meta.properties-rw-rw-r--  1 yunyu yunyu   22 Dec 26 16:57 recovery-point-offset-checkpoint-rw-rw-r--  1 yunyu yunyu   22 Dec 26 16:57 replication-offset-checkpoint</div></pre></td></tr></table></figure>
<p>注意：我们本地和线上的Kafka集群都是三台机器，Node1，Node2，Node3</p>
<p>于是我又查看了Kafka集群的其他几个节点，发现每个节点/data2都有数据，但是Topic数量却都不一样，golog这个Topic在Kafka的所有节点都有数据，但是node_log_test这个Topic却只在Node3有，在Node2和Node3就没有，这是啥情况啊？？？</p>
<p>后来我仔细想了一下，是我在创建Topic的时候没有指定副本个数，默认的副本个数是1个，所以就只会在Kafka集群的一个节点上有数据。为了验证我的想法，我又查询了一下这两个Topic的详细信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># golog这个Topic是有两个副本的，所以在三台机器上都有数据存储</div><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic gologTopic:golog	PartitionCount:1	ReplicationFactor:3	Configs:	Topic: golog	Partition: 0	Leader: 2	Replicas: 2,0,1	Isr: 0,1,2</div><div class="line">	</div><div class="line"></div><div class="line"># node_log_test这个Topic是没有副本的，所以在三台机器上只有Node3一台机器上有数据存储</div><div class="line">$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic node_log_testTopic:node_log_test	PartitionCount:1	ReplicationFactor:1	Configs:	Topic: node_log_test	Partition: 0	Leader: 2	Replicas: 2	Isr: 2</div></pre></td></tr></table></figure>
<p>根据上面的信息，我猜想有可能创建Topic的时候就已经指定存储的磁盘了（因为我们创建Topic的时候使用的之前的/data0磁盘，后来扩容的时候将/data0的磁盘数据整体迁移到/data1磁盘的），即使后来我们修改了log.dirs也只会影响新创建的Topic，对以前已经创建好的Topic是没有影响的。带着这个猜想，又仔细观察了一下线上Kafka服务器的kafka_data目录，/data1和/data2下面会有一些相同的文件，其他的文件夹都是Topic数据（log_go-0, log_node-0, log_php-0这三个是我们的Topic数据）。这几个相同的文件应该是指定log.dirs配置Kafka启动的时候创建的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ ls /data1/kafka_data</div><div class="line">.lock</div><div class="line">cleaner-offset-checkpoint</div><div class="line">log_go-0/</div><div class="line">log_node-0/</div><div class="line">log_php-0/</div><div class="line">meta.properties</div><div class="line">recovery-point-offset-checkpoint</div><div class="line">replication-offset-checkpoint</div><div class="line"></div><div class="line"></div><div class="line">$ ls /data2/kafka_data</div><div class="line">.lock</div><div class="line">cleaner-offset-checkpoint</div><div class="line">meta.properties</div><div class="line">recovery-point-offset-checkpoint</div><div class="line">replication-offset-checkpoint</div></pre></td></tr></table></figure>
<p>发现只有recovery-point-offset-checkpoint和replication-offset-checkpoint文件不同，/data1目录下的这两个文件都有记录对应Topic和offset，而/data2目录下的这两个文件都是空的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ vi /data1/kafka_data/recovery-point-offset-checkpoint</div><div class="line">0</div><div class="line">3</div><div class="line">log_node 0 18213007</div><div class="line">log_go 0 41049987</div><div class="line">log_php 0 100203453</div><div class="line"></div><div class="line"></div><div class="line">$ vi /data1/kafka_data/replication-offset-checkpoint</div><div class="line">0</div><div class="line">3</div><div class="line">log_node 0 18623953</div><div class="line">log_go 0 41248972</div><div class="line">log_php 0 100727371</div></pre></td></tr></table></figure>
<p>我大胆的猜测，Kafka就是靠这个来读取数据的，我只要把磁盘占用比较大的Topic数据移动到/data2/kafka_data目录下，并且把两个文件的内容修改正确，应该就可以做到安全迁移。</p>
<p>按照上面的思路，我将log_php这个占用47G的Topic迁移到/data2/kafka_data目录下，然后修改对应的recovery-point-offset-checkpoint和replication-offset-checkpoint文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ vi /data1/kafka_data/recovery-point-offset-checkpoint</div><div class="line">0</div><div class="line">2</div><div class="line">log_node 0 18213007</div><div class="line">log_go 0 41049987</div><div class="line"></div><div class="line">$ vi /data1/kafka_data/replication-offset-checkpoint</div><div class="line">0</div><div class="line">1</div><div class="line">log_php 0 100727371</div><div class="line"></div><div class="line">$ vi /data2/kafka_data/recovery-point-offset-checkpoint</div><div class="line">0</div><div class="line">2</div><div class="line">log_node 0 18213007</div><div class="line">log_go 0 41049987</div><div class="line"></div><div class="line"></div><div class="line">$ vi /data2/kafka_data/replication-offset-checkpoint</div><div class="line">0</div><div class="line">1</div><div class="line">log_php 0 100727371</div></pre></td></tr></table></figure>
<p>这里需要注意一下，第二行的数字是当前目录下的Topic数量，这一点是我根据本地Kafka集群和线上Kafka集群的配置的不同而推测出来的。</p>
<p>最后重启Kafka集群成功了~~</p>
<p>参考文章：</p>
<ul>
<li><a href="http://blog.csdn.net/rongyongfeikai2/article/details/49949115" target="_blank" rel="external">http://blog.csdn.net/rongyongfeikai2/article/details/49949115</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kafka/">Kafka</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/MQ/">MQ</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/Linux常用命令（四）" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/26/Linux/Linux常用命令（四）/" class="article-date">
  	<time datetime="2016-12-26T06:02:50.000Z" itemprop="datePublished">2016-12-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/26/Linux/Linux常用命令（四）/">Linux常用命令（四）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="kill命令"><a href="#kill命令" class="headerlink" title="kill命令"></a>kill命令</h3><p>kill命令是通过向进程发送指定的信号来结束相应进程的。在默认情况下，采用编号为15的TERM信号。TERM信号将终止所有不能捕获该信号的进程。对于那些可以捕获该信号的进程就要用编号为9的kill信号，强行“杀掉”该进程。</p>
<ol>
<li><p>命令格式：<br>kill[参数][进程号]</p>
</li>
<li><p>命令功能：<br>发送指定的信号到相应进程。不指定信号将发送SIGTERM（15）终止指定进程。如果任无法终止该程序可用“-KILL” 参数，其发送的信号为SIGKILL(9) ，将强制结束进程，使用ps命令或者jobs 命令可以查看进程号。root用户将影响用户的进程，非root用户只能影响自己的进程。</p>
</li>
<li><p>命令参数：</p>
</li>
</ol>
<ul>
<li>-l  信号，若果不加信号的编号参数，则使用“-l”参数会列出全部的信号名称</li>
<li>-a  当处理当前进程时，不限制命令名和进程号的对应关系</li>
<li>-p  指定kill 命令只打印相关进程的进程号，而不发送任何信号</li>
<li>-s  指定发送信号</li>
<li>-u  指定用户</li>
</ul>
<p>注意：</p>
<ol>
<li><p>kill命令可以带信号号码选项，也可以不带。如果没有信号号码，kill命令就会发出终止信号(15)，这个信号可以被进程捕获，使得进程在退出之前可以清理并释放资源。也可以用kill向进程发送特定的信号。例如：<br>kill -2 123<br>它的效果等同于在前台运行PID为123的进程时按下Ctrl+C键。但是，普通用户只能使用不带signal参数的kill命令或最多使用-9信号。</p>
</li>
<li><p>-9信号使进程强行终止，这常会带来一些副作用，如数据丢失或者终端无法恢复到正常状态。发送信号时必须小心，只有在万不得已时，才用kill信号(9)，因为进程不能首先捕获它。要撤销所有的后台作业，可以输入kill 0。因为有些在后台运行的命令会启动多个进程，跟踪并找到所有要杀掉的进程的PID是件很麻烦的事。这时，使用kill 0来终止所有由当前shell启动的进程，是个有效的方法。</p>
</li>
<li><p>特殊用法：kill -0 pid 不发送任何信号，但是系统会进行错误检查。所以经常用来检查一个进程是否存在，存在返回0；不存在返回1</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># 以下的方式都是使用TERM方式终止进程</div><div class="line">$ kill pid</div><div class="line">$ kill -15 pid</div><div class="line">$ kill -TERM pid</div><div class="line">$ kill -SIGTERM pid</div><div class="line"></div><div class="line"># 以下的方式都是使用KILL方式终止进程</div><div class="line">$ kill -9 pid</div><div class="line">$ kill -KILL pid</div><div class="line">$ kill -SIGKILL pid</div></pre></td></tr></table></figure>
<h4 id="kill-pid与kill-9-pid的区别"><a href="#kill-pid与kill-9-pid的区别" class="headerlink" title="kill pid与kill -9 pid的区别"></a>kill pid与kill -9 pid的区别</h4><ul>
<li>kill pid的作用是向进程号为pid的进程发送SIGTERM（这是kill默认发送的信号），该信号是一个结束进程的信号且可以被应用程序捕获。若应用程序没有捕获并响应该信号的逻辑代码，则该信号的默认动作是kill掉进程。这是终止指定进程的推荐做法。</li>
</ul>
<p>一旦进程接收到了SIGTERM信号，会有下面几种情况发生</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">the process may stop immediately</div><div class="line">the process may stop after a short delay after cleaning up resources</div><div class="line">the process may keep running indefinitely</div></pre></td></tr></table></figure>
<p>当接收到SIGTERM信号应用程序可以决定它自己如何处理，大多数的应用程序将会清理他们的资源并且停止运行，有一些则不是。当接收到SIGTERM信号一个应用程序可能会被配置做的事情完全不同。如果这个应用程序正处于一个不好的状态，例如等待磁盘IO，它可能无法相应我们发送的SIGTERM信号。</p>
<ul>
<li>kill -9 pid则是向进程号为pid的进程发送SIGKILL（该信号的编号为9），从本文上面的说明可知，SIGKILL既不能被应用程序捕获，也不能被阻塞或忽略，其动作是立即结束指定进程。通俗地说，应用程序根本无法“感知”SIGKILL信号，它在完全无准备的情况下，就被收到SIGKILL信号的操作系统给干掉了，显然，在这种“暴力”情况下，应用程序完全没有释放当前占用资源的机会。事实上，SIGKILL信号是直接发给init进程的，它收到该信号后，负责终止pid指定的进程。在某些情况下（如进程已经hang死，无法响应正常信号），就可以使用kill -9来结束进程。</li>
</ul>
<p>若通过kill结束的进程是一个创建过子进程的父进程，则其子进程就会成为孤儿进程（Orphan Process），这种情况下，子进程的退出状态就不能再被应用进程捕获（因为作为父进程的应用程序已经不存在了），不过应该不会对整个linux系统产生什么不利影响。</p>
<h4 id="应用程序如何优雅退出"><a href="#应用程序如何优雅退出" class="headerlink" title="应用程序如何优雅退出"></a>应用程序如何优雅退出</h4><p>Linux Server端的应用程序经常会长时间运行，在运行过程中，可能申请了很多系统资源，也可能保存了很多状态，在这些场景下，我们希望进程在退出前，可以释放资源或将当前状态dump到磁盘上或打印一些重要的日志，也就是希望进程优雅退出（exit gracefully）。</p>
<p>从上面的介绍不难看出，优雅退出可以通过捕获SIGTERM来实现。具体来讲，通常只需要两步动作：</p>
<p>1）注册SIGTERM信号的处理函数并在处理函数中做一些进程退出的准备。信号处理函数的注册可以通过signal()或sigaction()来实现，其中，推荐使用后者来实现信号响应函数的设置。信号处理函数的逻辑越简单越好，通常的做法是在该函数中设置一个bool型的flag变量以表明进程收到了SIGTERM信号，准备退出。</p>
<p>2）在主进程的main()中，通过类似于while(!bQuit)的逻辑来检测那个flag变量，一旦bQuit在signal handler function中被置为true，则主进程退出while()循环，接下来就是一些释放资源或dump进程当前状态或记录日志的动作，完成这些后，主进程退出。</p>
<p>参考文章：</p>
<ul>
<li><a href="http://blog.csdn.net/pecywang/article/details/8558968" target="_blank" rel="external">http://blog.csdn.net/pecywang/article/details/8558968</a></li>
<li><a href="http://www.cnblogs.com/peida/archive/2012/12/20/2825837.html" target="_blank" rel="external">http://www.cnblogs.com/peida/archive/2012/12/20/2825837.html</a></li>
<li><a href="http://blog.csdn.net/slvher/article/details/8977338" target="_blank" rel="external">http://blog.csdn.net/slvher/article/details/8977338</a></li>
<li><a href="https://major.io/2010/03/18/sigterm-vs-sigkill/" target="_blank" rel="external">https://major.io/2010/03/18/sigterm-vs-sigkill/</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 birdben
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>



<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82900755-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>